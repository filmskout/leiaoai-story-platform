import{e as v}from"./eth_sendRawTransaction-DPdnXbFR.js";import{d as U,a1 as B,B as x,I as l,J as S,ax as A,aw as D,y as $,f as c,e as w,c as M,a9 as d,ae as O}from"./Auth-Da7edH4x.js";import{concatHex as H}from"./concat-hex-DPpLtwyv.js";import{l as W,t as k}from"./to-serializable-transaction-CpnW1tN4.js";import{s as R}from"./sha2-D3jwzLbD.js";function C(t,e="hex"){const n=T(t),s=W(new Uint8Array(n.length));return n.encode(s),e==="hex"?U(s.bytes):s.bytes}function T(t){return Array.isArray(t)?N(t.map(e=>T(e))):V(t)}function N(t){const e=t.reduce((a,i)=>a+i.length,0),n=I(e);return{length:e<=55?1+e:1+n+e,encode(a){e<=55?a.pushByte(192+e):(a.pushByte(247+n),n===1?a.pushUint8(e):n===2?a.pushUint16(e):n===3?a.pushUint24(e):a.pushUint32(e));for(const{encode:i}of t)i(a)}}}function V(t){const e=typeof t=="string"?B(t):t,n=I(e.length);return{length:e.length===1&&e[0]<128?1:e.length<=55?1+e.length:1+n+e.length,encode(a){e.length===1&&e[0]<128?a.pushBytes(e):e.length<=55?(a.pushByte(128+e.length),a.pushBytes(e)):(a.pushByte(183+n),n===1?a.pushUint8(e.length):n===2?a.pushUint16(e.length):n===3?a.pushUint24(e.length):a.pushUint32(e.length),a.pushBytes(e))}}}function I(t){if(t<2**8)return 1;if(t<2**16)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new x("Length is too large.")}const J=2n**16n-1n,Z=R;function q(t,e){const n=Z(S(t,{strict:!1})?l(t):t);return A(n)}const b=J*32n;class K extends x{constructor({givenLength:e,maxBytecodeSize:n}){super(`Bytecode cannot be longer than ${n} bytes. Given length: ${e}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class Q extends x{constructor({givenLengthInWords:e}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${e}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class X extends x{constructor({givenLength:e}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${e}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function Y(t){const e=l(t);if(e.length%32!==0)throw new X({givenLength:e.length});if(e.length>b)throw new K({givenLength:e.length,maxBytecodeSize:b});const n=q(e),s=l(n),a=e.length/32;if(a%2===0)throw new Q({givenLengthInWords:a});const i=l(a),r=D(i,{size:2}),o=new Uint8Array([1,0]);return s.set(o,0),s.set(r,2),s}function f(t){if(["string","number"].includes(typeof t)&&!Number.isInteger(Number(t)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${t} of type ${typeof t}`);return t instanceof Uint8Array?BigInt($(t)):BigInt(t)}const P=(t,e)=>typeof t=="bigint"?e(t):Array.isArray(t)?t.map(n=>P(n,e)):t&&typeof t=="object"?Object.fromEntries(Object.entries(t).map(([n,s])=>[n,P(s,e)])):t,L=50000n,j=t=>{const e=ee(t);return{domain:{chainId:t.chainId,name:"zkSync",version:"2"},message:e,primaryType:"Transaction",types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]}}};function ee(t){const{gas:e,nonce:n,to:s,from:a,value:i,maxFeePerGas:r,maxPriorityFeePerGas:o,paymaster:u,paymasterInput:y,gasPerPubdata:g,data:m,factoryDeps:p}=t;return{data:m||"0x0",factoryDeps:(p==null?void 0:p.map(h=>c(Y(h))))??[],from:BigInt(a),gasLimit:e??0n,gasPerPubdataByteLimit:g??L,maxFeePerGas:r??0n,maxPriorityFeePerGas:o??0n,nonce:n?BigInt(n):0n,paymaster:u?BigInt(u):0n,paymasterInput:y||"0x",to:s?BigInt(s):0n,txType:113n,value:i??0n}}async function te(t){const{account:e,transaction:n}=t,s=await F(t),a=await E({account:e,chainId:n.chain.id,eip712Transaction:s}),i=w(n),r=await v(i,a);return{chain:n.chain,client:n.client,transactionHash:r}}async function E(t){const{account:e,eip712Transaction:n,chainId:s}=t,a=j(n),i=await e.signTypedData({...a});return ne({...n,chainId:s,customSignature:i})}async function F(t){const{account:e,transaction:n}=t,{gas:s,maxFeePerGas:a,maxPriorityFeePerGas:i,gasPerPubdata:r}=await G({from:M(e.address),transaction:n});return{...await k({from:e.address,transaction:{...n,gas:s,maxFeePerGas:a,maxPriorityFeePerGas:i}}),...n.eip712,from:e.address,gasPerPubdata:r}}function ne(t){const{chainId:e,gas:n,nonce:s,to:a,from:i,value:r,maxFeePerGas:o,maxPriorityFeePerGas:u,customSignature:y,factoryDeps:g,paymaster:m,paymasterInput:p,gasPerPubdata:h,data:_}=t,z=[s?c(s):"0x",u?c(u):"0x",o?c(o):"0x",n?c(n):"0x",a??"0x",r?c(r):"0x",_??"0x0",c(e),c(""),c(""),c(e),i??"0x",h?c(h):c(L),g??[],y??"0x",m&&p?[m,p]:[]];return H(["0x71",C(z)])}async function G(t){const{transaction:e,from:n}=t;let[s,a,i,r]=await Promise.all([d(e.gas),d(e.maxFeePerGas),d(e.maxPriorityFeePerGas),d(e.eip712)]),o=r==null?void 0:r.gasPerPubdata;if(s===void 0||a===void 0||i===void 0){const u=w(e),y=await ae({from:n,transaction:e}),g=await u({method:"zks_estimateFee",params:[P(y,c)]});s=f(g.gas_limit)*2n,a=f(g.max_fee_per_gas)*2n,i=f(g.max_priority_fee_per_gas)||1n,o=f(g.gas_per_pubdata_limit)*2n,o<50000n&&(o=50000n)}return{gas:s,gasPerPubdata:o,maxFeePerGas:a,maxPriorityFeePerGas:i}}async function ae(t){var u;const{transaction:e,from:n}=t,[s,a,i,r]=await Promise.all([O(e),d(e.to),d(e.value),d(e.eip712)]),o=r==null?void 0:r.gasPerPubdata;return{data:s,eip712Meta:{...r,factoryDeps:(u=r==null?void 0:r.factoryDeps)==null?void 0:u.map(y=>Array.from(B(y))),gasPerPubdata:o||50000n},from:n,gasPerPubdata:o,to:a,type:"0x71",value:i}}const ue=Object.freeze(Object.defineProperty({__proto__:null,getZkGasFees:G,populateEip712Transaction:F,sendEip712Transaction:te,signEip712Transaction:E},Symbol.toStringTag,{value:"Module"}));export{ue as a,F as p,E as s,f as t};
