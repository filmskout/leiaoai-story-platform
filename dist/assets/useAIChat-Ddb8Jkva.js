import{c as q,b as D,a as V,u as W,l as Z,s as T}from"./index-Dy8cuphJ.js";import{j as e}from"./vendor-ui-DPGpZYCr.js";import{r as i}from"./vendor-react-CpsyMv2-.js";import{m as h}from"./proxy-CiyaKLYz.js";import{A as P}from"./index-IhUUfVPt.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=q("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);function J(){const I=i.useRef(!1);return i.useEffect(()=>(I.current=!0,()=>{I.current=!1}),[]),I}const F=["/assets/images/colorful-a-logos/4e6b2617027479935bf1b7784ea5fda6.png","/assets/images/colorful-a-logos/0dd4e7a645d39d47a1a37edbea1903a6.png","/assets/images/colorful-a-logos/f14b90310c75515811ea373edd51317e.png","/assets/images/colorful-a-logos/b8aa7ded0d232cbb1927a4b96950a01b.png","/assets/images/colorful-a-logos/8cc34242080cef98b02f02eaeeb5688a.png","/assets/images/colorful-a-logos/04d54a35c3aa502601ee949629703971.png","/assets/images/colorful-a-logos/1e569cd5f45203b861823cafd46b01c3.png","/assets/images/colorful-a-logos/c8c215033b0ab701f198b4520348c12f.png"],G=(()=>{let I=!1;return()=>{I||(F.forEach(a=>{const f=new Image;f.src=a}),I=!0)}})(),ne=i.memo(function({show:a=!0,variant:f,mode:c="inline",size:b="md",text:l,subText:u=(f||c)==="page"||(f||c)==="fullscreen"?"蕾奥AI正在为您思考...":void 0,className:m,onComplete:N,minDuration:C=1500,showProgress:j=(f||c)==="cover",progress:E,background:S=(f||c)==="fullscreen"?"blur":(f||c)==="page"?"solid":"none",ariaLabel:L="加载中",ariaLive:B="polite"}){const v=f||c,[_,k]=i.useState(a),[R,O]=i.useState(0),[r,x]=i.useState(0),p=J(),n=i.useRef(),s=i.useRef();i.useEffect(()=>{G()},[]);const d={xs:{logo:"w-6 h-6",dots:1,dotsCount:3,dotsRadius:15},sm:{logo:"w-10 h-10",dots:1.5,dotsCount:4,dotsRadius:20},md:{logo:"w-16 h-16",dots:2,dotsCount:5,dotsRadius:25},lg:{logo:"w-24 h-24",dots:2.5,dotsCount:5,dotsRadius:30},xl:{logo:"w-32 h-32",dots:3,dotsCount:6,dotsRadius:35}},y={blur:"bg-background/80 backdrop-blur-sm",solid:"bg-white dark:bg-slate-900",none:""};i.useEffect(()=>{if(!a&&v!=="inline")return s.current=window.setTimeout(()=>{p.current&&(k(!1),N&&N())},C),()=>{s.current&&window.clearTimeout(s.current)};k(a)},[a,C,N,v,p]);const w=i.useCallback(()=>{O(t=>(t+1)%F.length)},[]);i.useEffect(()=>{if(a)return n.current=window.setInterval(w,200),()=>{n.current&&window.clearInterval(n.current)}},[a,w]),i.useEffect(()=>{if(!j||!a)return;if(E!==void 0){x(E);return}let t;t=window.setInterval(()=>{p.current&&x(A=>A>=70?(clearInterval(t),A):Math.min(70,A+Math.random()*5))},200);const g=window.setTimeout(()=>{clearInterval(t),p.current&&x(100)},5e3);return()=>{clearTimeout(g),clearInterval(t)}},[a,j,E,p]);const z=t=>{const{dots:g,dotsCount:A,dotsRadius:$}=t;return[...Array(A)].map((K,M)=>e.jsx(h.div,{className:"absolute bg-white rounded-full",style:{width:`${g}px`,height:`${g}px`,top:"50%",left:"50%",marginTop:`-${g/2}px`,marginLeft:`-${g/2}px`,transformOrigin:`${$}px 0px`},animate:{rotate:[0+M*(360/A),360+M*(360/A)],opacity:[.7,.9,.7]},transition:{rotate:{duration:3,repeat:1/0,ease:"linear"},opacity:{duration:2,repeat:1/0,ease:"easeInOut"},delay:M*.1}},M))},U=d[b],o=i.memo(({size:t,currentImageIndex:g,dotsConfig:A})=>e.jsx("div",{className:"relative h-full w-full flex items-center justify-center","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:246:4","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"246","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22relative%20h-full%20w-full%20flex%20items-center%20justify-center%22%7D",children:e.jsxs(h.div,{initial:{scale:.5,opacity:0},animate:{scale:[.5,1.2,1],opacity:1},transition:{duration:.5,repeat:0},className:"relative h-full w-full",children:[e.jsx("div",{className:"absolute inset-0 bg-white/90 dark:bg-white/80 rounded-full flex items-center justify-center shadow-md","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:260:8","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"260","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22absolute%20inset-0%20bg-white%2F90%20dark%3Abg-white%2F80%20rounded-full%20flex%20items-center%20justify-center%20shadow-md%22%7D"}),e.jsx("img",{src:F[g],alt:"蕾奥AI Logo",className:"absolute inset-0 w-full h-full object-contain relative z-10",loading:"eager","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:261:8","data-matrix-name":"img","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"261","data-component-file":"UnifiedLoader.tsx","data-component-name":"img","data-component-content":"%7B%22src%22%3A%22%5BMemberExpression%5D%22%2C%22alt%22%3A%22%E8%95%BE%E5%A5%A5AI%20Logo%22%2C%22className%22%3A%22absolute%20inset-0%20w-full%20h-full%20object-contain%20relative%20z-10%22%2C%22loading%22%3A%22eager%22%7D"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:269:8","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"269","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22absolute%20inset-0%20flex%20items-center%20justify-center%22%7D",children:z(A)})]})}));return v==="inline"?a?e.jsxs(h.div,{className:D("flex flex-col items-center justify-center",m),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},role:"status","aria-label":L,"aria-live":B,children:[e.jsx("div",{className:D(U.logo),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:295:8","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"295","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:b,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:296:10","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"296","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),l&&e.jsxs(h.div,{className:"text-center mt-4",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:[e.jsx("p",{className:"text-sm font-medium text-foreground","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:309:12","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"309","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-sm%20font-medium%20text-foreground%22%7D",children:l}),u&&e.jsx("p",{className:"text-xs text-foreground-muted mt-1","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:311:14","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"311","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-xs%20text-foreground-muted%20mt-1%22%7D",children:u})]})]}):null:v==="fullscreen"?e.jsx(P,{"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:322:6","data-matrix-name":"AnimatePresence","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"322","data-component-file":"UnifiedLoader.tsx","data-component-name":"AnimatePresence",children:_&&e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:D("fixed inset-0 z-50 flex flex-col items-center justify-center",y[S],m),role:"status","aria-label":L,"aria-live":B,children:[e.jsx("div",{className:D(U.logo,"mb-8"),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:338:12","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"338","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:b,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:339:14","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"339","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),(l||u)&&e.jsxs(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-center",children:[l&&e.jsx("p",{className:"text-lg font-medium text-foreground mb-2","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:354:18","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"354","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-lg%20font-medium%20text-foreground%20mb-2%22%7D",children:l}),u&&e.jsx("p",{className:"text-sm text-foreground-muted","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:359:18","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"359","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-sm%20text-foreground-muted%22%7D",children:u})]}),e.jsx(h.div,{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2",animate:{y:[0,5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:"h-1 w-48 bg-gradient-to-r from-primary-300 via-primary-500 to-primary-300 rounded-full opacity-70","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:378:14","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"378","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22h-1%20w-48%20bg-gradient-to-r%20from-primary-300%20via-primary-500%20to-primary-300%20rounded-full%20opacity-70%22%7D"})})]})}):v==="page"?e.jsx(P,{"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:389:6","data-matrix-name":"AnimatePresence","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"389","data-component-file":"UnifiedLoader.tsx","data-component-name":"AnimatePresence",children:_&&e.jsxs(h.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:D("fixed inset-0 flex flex-col items-center justify-center z-50",y[S],"overflow-hidden",m),role:"status","aria-label":L,"aria-live":B,children:[e.jsx("div",{className:D(U.logo,"mb-6"),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:406:12","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"406","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:b,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:407:14","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"407","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},className:"text-center",children:[e.jsx(h.h1,{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:l||"蕾奥AI"}),e.jsx(h.p,{className:"mt-2 text-base text-neutral-500 dark:text-neutral-400",animate:{opacity:[.5,.8,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.5},children:u||"专业AI投资顾问"})]})]})}):v==="cover"?e.jsx(P,{"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:444:6","data-matrix-name":"AnimatePresence","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"444","data-component-file":"UnifiedLoader.tsx","data-component-name":"AnimatePresence",children:_&&e.jsxs(h.div,{className:D("fixed inset-0 z-50 flex flex-col items-center justify-center",y[S],m),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},role:"status","aria-label":L,"aria-live":B,children:[e.jsx("div",{className:D(U.logo,"mb-8"),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:460:12","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"460","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:b,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:461:14","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"461","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),e.jsx(h.h1,{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:l||"蕾奥AI"}),e.jsx(h.p,{className:"mt-2 text-base text-neutral-500 dark:text-neutral-400",animate:{opacity:[.5,.8,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.5},children:u||"专业AI投资顾问"}),j&&e.jsx("div",{className:"w-64 h-1 bg-neutral-200 dark:bg-neutral-700 rounded-full mt-8 overflow-hidden",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:485:14","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"485","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22w-64%20h-1%20bg-neutral-200%20dark%3Abg-neutral-700%20rounded-full%20mt-8%20overflow-hidden%22%2C%22role%22%3A%22progressbar%22%7D",children:e.jsx(h.div,{className:"h-full bg-primary-500",initial:{width:0},animate:{width:`${r}%`},transition:{ease:"easeInOut"}})})]})}):null});i.lazy(async()=>Promise.resolve({default:UnifiedLoaderComponent}));async function H(I,a="deepseek",f="zh"){var b;const c=Date.now();try{const l=I[I.length-1];if(!l||!l.content)throw new Error("No message content provided");console.log("🔵 Frontend: Calling AI Chat API",{model:a,messageLength:l.content.length});const u=await fetch("/api/ai-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l.content,model:a,sessionId:crypto.randomUUID()})});if(console.log("🔵 Frontend: API Response Status",u.status,u.statusText),!u.ok){const j=await u.text();throw console.error("🔴 Frontend: API Error Response",j.slice(0,200)),new Error(j||"AI service temporarily unavailable")}const m=await u.json();if(!m||!m.data)throw console.error("🔴 Frontend: Invalid response structure",m),new Error("Invalid response from AI service");const N=Date.now(),C=Number(((N-c)/1e3).toFixed(1));return console.log("🟢 Frontend: Success",{model:m.data.model,responseLength:(b=m.data.content)==null?void 0:b.length,time:C}),{response:m.data.content||"No response generated",model:m.data.model||a,processingTime:C}}catch(l){console.error("🔴 Frontend: Error in fetchAIResponse:",l);const m=f.startsWith("zh")?"抱歉，AI服务暂时不可用。请稍后再试，或尝试切换其他模型。":"Sorry, AI service is temporarily unavailable. Please try again later or switch to another model.";throw new Error(m)}}function oe(){const[I,a]=i.useState([]),[f,c]=i.useState(null),[b,l]=i.useState(!1),[u,m]=i.useState(null),[N,C]=i.useState(!0),{selectedChatModel:j,updateModelResponseTime:E}=V(),{i18n:S}=W(),{user:L}=Z()||{user:null},B=async()=>{C(!0);try{const{data:r,error:x}=await T.from("chat_sessions").select("*").eq("user_id",(L==null?void 0:L.id)||null).order("updated_at",{ascending:!1});if(x){console.error("Failed to load chat sessions:",x);return}if(r){const p=await Promise.all(r.map(async n=>{const{data:s,error:d}=await T.from("chat_messages").select("*").eq("session_id",n.session_id).order("created_at",{ascending:!0}),y=s?s.map(w=>({id:w.id.toString(),role:w.role,content:w.content,timestamp:new Date(w.created_at),aiModel:w.ai_model||void 0,processingTime:w.processing_time||void 0})):[];return{id:n.session_id,title:n.title||"新的对话",messages:y,createdAt:new Date(n.created_at),updatedAt:new Date(n.updated_at)}}));a(p)}}catch(r){console.error("Error loading chat sessions:",r)}finally{C(!1)}};i.useEffect(()=>{B()},[L]);const v=async r=>{const x=crypto.randomUUID(),p=r||"新的投融资咨询";try{const{data:n,error:s}=await T.from("chat_sessions").insert({session_id:x,user_id:(L==null?void 0:L.id)||null,title:p,message_count:0}).select().maybeSingle();if(s)throw console.error("Failed to create session in database:",s),new Error("创建会话失败");const d={id:x,title:p,messages:[],createdAt:new Date,updatedAt:new Date};return a(y=>[d,...y]),c(d),d}catch(n){console.error("Error creating new session:",n);const s={id:x,title:p,messages:[],createdAt:new Date,updatedAt:new Date};return a(d=>[s,...d]),c(s),s}};return{sessions:I,currentSession:f,isLoading:b,isLoadingSessions:N,error:u,sendMessage:async(r,x,p)=>{if(r.trim()){l(!0),m(null);try{let n=f;n||(n=await v());const s={id:crypto.randomUUID(),role:"user",content:r,timestamp:new Date},d={...n,messages:[...n.messages,s],updatedAt:new Date};c(d),a(o=>o.map(t=>t.id===n.id?d:t));const y=crypto.randomUUID(),w=p||j,z={id:y,role:"assistant",content:"",timestamp:new Date,aiModel:w,isTyping:!1},U={...d,messages:[...d.messages,z],updatedAt:new Date};c(U),a(o=>o.map(t=>t.id===n.id?U:t));try{const o=await H([{role:"user",content:r}],w,S.language);if(o.processingTime>0)try{E(o.model,o.processingTime)}catch(t){console.warn("更新模型响应时间失败:",t)}a(t=>t.map(g=>({...g,messages:g.messages.map(A=>A.id===y?{...A,content:o.response,aiModel:o.model,processingTime:o.processingTime,isTyping:!1}:A)}))),c(t=>t&&{...t,messages:t.messages.map(g=>g.id===y?{...g,content:o.response,aiModel:o.model,processingTime:o.processingTime,isTyping:!1}:g)});try{await T.from("chat_messages").insert([{session_id:n.id,role:"user",content:r,ai_model:null,processing_time:null},{session_id:n.id,role:"assistant",content:o.response,ai_model:o.model,processing_time:o.processingTime}])}catch(t){console.warn("保存消息到数据库失败:",t)}}catch(o){throw o}}catch(n){console.error("发送消息失败:",n),m(n instanceof Error?n.message:"发送消息失败"),c(s=>s&&{...s,messages:s.messages.filter(d=>d.role!=="assistant"||d.content!=="")}),a(s=>s.map(d=>({...d,messages:d.messages.filter(y=>y.role!=="assistant"||y.content!=="")})))}finally{l(!1)}}},createNewSession:v,switchSession:r=>{const x=I.find(p=>p.id===r);x&&c(x)},deleteSession:r=>{a(x=>x.filter(p=>p.id!==r)),(f==null?void 0:f.id)===r&&c(null)},clearAllSessions:()=>{a([]),c(null)},loadChatSessions:B}}export{ae as R,ne as U,oe as u};
