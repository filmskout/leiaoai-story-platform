import{c as q,r as s,j as e,d as j,a as V,u as W,n as Z,s as T}from"./index-CW0o6enZ.js";import{m as g}from"./proxy-B3uV5eva.js";import{A as O}from"./index-CQvtHsoJ.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=q("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);function J(){const y=s.useRef(!1);return s.useEffect(()=>(y.current=!0,()=>{y.current=!1}),[]),y}const P=["/assets/images/colorful-a-logos/4e6b2617027479935bf1b7784ea5fda6.png","/assets/images/colorful-a-logos/0dd4e7a645d39d47a1a37edbea1903a6.png","/assets/images/colorful-a-logos/f14b90310c75515811ea373edd51317e.png","/assets/images/colorful-a-logos/b8aa7ded0d232cbb1927a4b96950a01b.png","/assets/images/colorful-a-logos/8cc34242080cef98b02f02eaeeb5688a.png","/assets/images/colorful-a-logos/04d54a35c3aa502601ee949629703971.png","/assets/images/colorful-a-logos/1e569cd5f45203b861823cafd46b01c3.png","/assets/images/colorful-a-logos/c8c215033b0ab701f198b4520348c12f.png"],G=(()=>{let y=!1;return()=>{y||(P.forEach(n=>{const m=new Image;m.src=n}),y=!0)}})(),te=s.memo(function({show:n=!0,variant:m,mode:c="inline",size:I="md",text:u,subText:p=(m||c)==="page"||(m||c)==="fullscreen"?"蕾奥AI正在为您思考...":void 0,className:b,onComplete:C,minDuration:D=1500,showProgress:B=(m||c)==="cover",progress:E,background:S=(m||c)==="fullscreen"?"blur":(m||c)==="page"?"solid":"none",ariaLabel:L="加载中",ariaLive:N="polite"}){const v=m||c,[_,k]=s.useState(n),[R,$]=s.useState(0),[r,f]=s.useState(0),l=J(),a=s.useRef(),i=s.useRef();s.useEffect(()=>{G()},[]);const d={xs:{logo:"w-6 h-6",dots:1,dotsCount:3,dotsRadius:15},sm:{logo:"w-10 h-10",dots:1.5,dotsCount:4,dotsRadius:20},md:{logo:"w-16 h-16",dots:2,dotsCount:5,dotsRadius:25},lg:{logo:"w-24 h-24",dots:2.5,dotsCount:5,dotsRadius:30},xl:{logo:"w-32 h-32",dots:3,dotsCount:6,dotsRadius:35}},h={blur:"bg-background/80 backdrop-blur-sm",solid:"bg-white dark:bg-slate-900",none:""};s.useEffect(()=>{if(!n&&v!=="inline")return i.current=window.setTimeout(()=>{l.current&&(k(!1),C&&C())},D),()=>{i.current&&window.clearTimeout(i.current)};k(n)},[n,D,C,v,l]);const w=s.useCallback(()=>{$(t=>(t+1)%P.length)},[]);s.useEffect(()=>{if(n)return a.current=window.setInterval(w,200),()=>{a.current&&window.clearInterval(a.current)}},[n,w]),s.useEffect(()=>{if(!B||!n)return;if(E!==void 0){f(E);return}let t;t=window.setInterval(()=>{l.current&&f(A=>A>=70?(clearInterval(t),A):Math.min(70,A+Math.random()*5))},200);const x=window.setTimeout(()=>{clearInterval(t),l.current&&f(100)},5e3);return()=>{clearTimeout(x),clearInterval(t)}},[n,B,E,l]);const z=t=>{const{dots:x,dotsCount:A,dotsRadius:F}=t;return[...Array(A)].map((K,M)=>e.jsx(g.div,{className:"absolute bg-white rounded-full",style:{width:`${x}px`,height:`${x}px`,top:"50%",left:"50%",marginTop:`-${x/2}px`,marginLeft:`-${x/2}px`,transformOrigin:`${F}px 0px`},animate:{rotate:[0+M*(360/A),360+M*(360/A)],opacity:[.7,.9,.7]},transition:{rotate:{duration:3,repeat:1/0,ease:"linear"},opacity:{duration:2,repeat:1/0,ease:"easeInOut"},delay:M*.1}},M))},U=d[I],o=s.memo(({size:t,currentImageIndex:x,dotsConfig:A})=>e.jsx("div",{className:"relative h-full w-full flex items-center justify-center","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:246:4","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"246","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22relative%20h-full%20w-full%20flex%20items-center%20justify-center%22%7D",children:e.jsxs(g.div,{initial:{scale:.5,opacity:0},animate:{scale:[.5,1.2,1],opacity:1},transition:{duration:.5,repeat:0},className:"relative h-full w-full",children:[e.jsx("div",{className:"absolute inset-0 bg-white/90 dark:bg-white/80 rounded-full flex items-center justify-center shadow-md","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:260:8","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"260","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22absolute%20inset-0%20bg-white%2F90%20dark%3Abg-white%2F80%20rounded-full%20flex%20items-center%20justify-center%20shadow-md%22%7D"}),e.jsx("img",{src:P[x],alt:"蕾奥AI Logo",className:"absolute inset-0 w-full h-full object-contain relative z-10",loading:"eager","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:261:8","data-matrix-name":"img","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"261","data-component-file":"UnifiedLoader.tsx","data-component-name":"img","data-component-content":"%7B%22src%22%3A%22%5BMemberExpression%5D%22%2C%22alt%22%3A%22%E8%95%BE%E5%A5%A5AI%20Logo%22%2C%22className%22%3A%22absolute%20inset-0%20w-full%20h-full%20object-contain%20relative%20z-10%22%2C%22loading%22%3A%22eager%22%7D"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:269:8","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"269","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22absolute%20inset-0%20flex%20items-center%20justify-center%22%7D",children:z(A)})]})}));return v==="inline"?n?e.jsxs(g.div,{className:j("flex flex-col items-center justify-center",b),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},role:"status","aria-label":L,"aria-live":N,children:[e.jsx("div",{className:j(U.logo),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:295:8","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"295","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:I,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:296:10","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"296","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),u&&e.jsxs(g.div,{className:"text-center mt-4",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:[e.jsx("p",{className:"text-sm font-medium text-foreground","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:309:12","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"309","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-sm%20font-medium%20text-foreground%22%7D",children:u}),p&&e.jsx("p",{className:"text-xs text-foreground-muted mt-1","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:311:14","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"311","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-xs%20text-foreground-muted%20mt-1%22%7D",children:p})]})]}):null:v==="fullscreen"?e.jsx(O,{"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:322:6","data-matrix-name":"AnimatePresence","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"322","data-component-file":"UnifiedLoader.tsx","data-component-name":"AnimatePresence",children:_&&e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:j("fixed inset-0 z-50 flex flex-col items-center justify-center",h[S],b),role:"status","aria-label":L,"aria-live":N,children:[e.jsx("div",{className:j(U.logo,"mb-8"),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:338:12","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"338","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:I,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:339:14","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"339","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),(u||p)&&e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-center",children:[u&&e.jsx("p",{className:"text-lg font-medium text-foreground mb-2","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:354:18","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"354","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-lg%20font-medium%20text-foreground%20mb-2%22%7D",children:u}),p&&e.jsx("p",{className:"text-sm text-foreground-muted","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:359:18","data-matrix-name":"p","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"359","data-component-file":"UnifiedLoader.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-sm%20text-foreground-muted%22%7D",children:p})]}),e.jsx(g.div,{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2",animate:{y:[0,5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:"h-1 w-48 bg-gradient-to-r from-primary-300 via-primary-500 to-primary-300 rounded-full opacity-70","data-matrix-id":"src/components/ui/UnifiedLoader.tsx:378:14","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"378","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22h-1%20w-48%20bg-gradient-to-r%20from-primary-300%20via-primary-500%20to-primary-300%20rounded-full%20opacity-70%22%7D"})})]})}):v==="page"?e.jsx(O,{"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:389:6","data-matrix-name":"AnimatePresence","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"389","data-component-file":"UnifiedLoader.tsx","data-component-name":"AnimatePresence",children:_&&e.jsxs(g.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:j("fixed inset-0 flex flex-col items-center justify-center z-50",h[S],"overflow-hidden",b),role:"status","aria-label":L,"aria-live":N,children:[e.jsx("div",{className:j(U.logo,"mb-6"),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:406:12","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"406","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:I,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:407:14","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"407","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},className:"text-center",children:[e.jsx(g.h1,{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:u||"蕾奥AI"}),e.jsx(g.p,{className:"mt-2 text-base text-neutral-500 dark:text-neutral-400",animate:{opacity:[.5,.8,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.5},children:p||"专业AI投资顾问"})]})]})}):v==="cover"?e.jsx(O,{"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:444:6","data-matrix-name":"AnimatePresence","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"444","data-component-file":"UnifiedLoader.tsx","data-component-name":"AnimatePresence",children:_&&e.jsxs(g.div,{className:j("fixed inset-0 z-50 flex flex-col items-center justify-center",h[S],b),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},role:"status","aria-label":L,"aria-live":N,children:[e.jsx("div",{className:j(U.logo,"mb-8"),"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:460:12","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"460","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%7D",children:e.jsx(o,{size:I,currentImageIndex:R,dotsConfig:U,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:461:14","data-matrix-name":"ColorfulALogoRenderer","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"461","data-component-file":"UnifiedLoader.tsx","data-component-name":"ColorfulALogoRenderer","data-component-content":"%7B%22size%22%3A%22%5BIdentifier%5D%22%2C%22currentImageIndex%22%3A%22%5BIdentifier%5D%22%2C%22dotsConfig%22%3A%22%5BIdentifier%5D%22%7D"})}),e.jsx(g.h1,{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:u||"蕾奥AI"}),e.jsx(g.p,{className:"mt-2 text-base text-neutral-500 dark:text-neutral-400",animate:{opacity:[.5,.8,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.5},children:p||"专业AI投资顾问"}),B&&e.jsx("div",{className:"w-64 h-1 bg-neutral-200 dark:bg-neutral-700 rounded-full mt-8 overflow-hidden",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"data-matrix-id":"src/components/ui/UnifiedLoader.tsx:485:14","data-matrix-name":"div","data-component-path":"src/components/ui/UnifiedLoader.tsx","data-component-line":"485","data-component-file":"UnifiedLoader.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22w-64%20h-1%20bg-neutral-200%20dark%3Abg-neutral-700%20rounded-full%20mt-8%20overflow-hidden%22%2C%22role%22%3A%22progressbar%22%7D",children:e.jsx(g.div,{className:"h-full bg-primary-500",initial:{width:0},animate:{width:`${r}%`},transition:{ease:"easeInOut"}})})]})}):null});s.lazy(async()=>Promise.resolve({default:UnifiedLoaderComponent}));async function H(y,n="deepseek",m="zh"){const c=Date.now();try{const I=y[y.length-1];if(!I||!I.content)throw new Error("No message content provided");const u=await fetch("/api/ai-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:I.content,model:n,sessionId:crypto.randomUUID()})});if(!u.ok){const D=await u.text();throw new Error(D||"AI service temporarily unavailable")}const p=await u.json();if(!p||!p.data)throw new Error("Invalid response from AI service");const b=Date.now(),C=Number(((b-c)/1e3).toFixed(1));return{response:p.data.content||"No response generated",model:p.data.model||n,processingTime:C}}catch(I){console.error("Error in fetchAIResponse:",I);const p=m.startsWith("zh")?"抱歉，AI服务暂时不可用。请稍后再试，或尝试切换其他模型。":"Sorry, AI service is temporarily unavailable. Please try again later or switch to another model.";throw new Error(p)}}function ae(){const[y,n]=s.useState([]),[m,c]=s.useState(null),[I,u]=s.useState(!1),[p,b]=s.useState(null),[C,D]=s.useState(!0),{selectedChatModel:B,updateModelResponseTime:E}=V(),{i18n:S}=W(),{user:L}=Z()||{user:null},N=async()=>{D(!0);try{const{data:r,error:f}=await T.from("chat_sessions").select("*").eq("user_id",(L==null?void 0:L.id)||null).order("updated_at",{ascending:!1});if(f){console.error("Failed to load chat sessions:",f);return}if(r){const l=await Promise.all(r.map(async a=>{const{data:i,error:d}=await T.from("chat_messages").select("*").eq("session_id",a.session_id).order("created_at",{ascending:!0}),h=i?i.map(w=>({id:w.id.toString(),role:w.role,content:w.content,timestamp:new Date(w.created_at),aiModel:w.ai_model||void 0,processingTime:w.processing_time||void 0})):[];return{id:a.session_id,title:a.title||"新的对话",messages:h,createdAt:new Date(a.created_at),updatedAt:new Date(a.updated_at)}}));n(l)}}catch(r){console.error("Error loading chat sessions:",r)}finally{D(!1)}};s.useEffect(()=>{N()},[L]);const v=async r=>{const f=crypto.randomUUID(),l=r||"新的投融资咨询";try{const{data:a,error:i}=await T.from("chat_sessions").insert({session_id:f,user_id:(L==null?void 0:L.id)||null,title:l,message_count:0}).select().maybeSingle();if(i)throw console.error("Failed to create session in database:",i),new Error("创建会话失败");const d={id:f,title:l,messages:[],createdAt:new Date,updatedAt:new Date};return n(h=>[d,...h]),c(d),d}catch(a){console.error("Error creating new session:",a);const i={id:f,title:l,messages:[],createdAt:new Date,updatedAt:new Date};return n(d=>[i,...d]),c(i),i}};return{sessions:y,currentSession:m,isLoading:I,isLoadingSessions:C,error:p,sendMessage:async(r,f,l)=>{if(r.trim()){u(!0),b(null);try{let a=m;a||(a=await v());const i={id:crypto.randomUUID(),role:"user",content:r,timestamp:new Date},d={...a,messages:[...a.messages,i],updatedAt:new Date};c(d),n(o=>o.map(t=>t.id===a.id?d:t));const h=crypto.randomUUID(),w=l||B,z={id:h,role:"assistant",content:"",timestamp:new Date,aiModel:w,isTyping:!1},U={...d,messages:[...d.messages,z],updatedAt:new Date};c(U),n(o=>o.map(t=>t.id===a.id?U:t));try{const o=await H([{role:"user",content:r}],w,S.language);if(o.processingTime>0)try{E(o.model,o.processingTime)}catch(t){console.warn("更新模型响应时间失败:",t)}n(t=>t.map(x=>({...x,messages:x.messages.map(A=>A.id===h?{...A,content:o.response,aiModel:o.model,processingTime:o.processingTime,isTyping:!1}:A)}))),c(t=>t&&{...t,messages:t.messages.map(x=>x.id===h?{...x,content:o.response,aiModel:o.model,processingTime:o.processingTime,isTyping:!1}:x)});try{await T.from("chat_messages").insert([{session_id:a.id,role:"user",content:r,ai_model:null,processing_time:null},{session_id:a.id,role:"assistant",content:o.response,ai_model:o.model,processing_time:o.processingTime}])}catch(t){console.warn("保存消息到数据库失败:",t)}}catch(o){throw o}}catch(a){console.error("发送消息失败:",a),b(a instanceof Error?a.message:"发送消息失败"),c(i=>i&&{...i,messages:i.messages.filter(d=>d.role!=="assistant"||d.content!=="")}),n(i=>i.map(d=>({...d,messages:d.messages.filter(h=>h.role!=="assistant"||h.content!=="")})))}finally{u(!1)}}},createNewSession:v,switchSession:r=>{const f=y.find(l=>l.id===r);f&&c(f)},deleteSession:r=>{n(f=>f.filter(l=>l.id!==r)),(m==null?void 0:m.id)===r&&c(null)},clearAllSessions:()=>{n([]),c(null)},loadChatSessions:N}}export{ee as R,te as U,ae as u};
