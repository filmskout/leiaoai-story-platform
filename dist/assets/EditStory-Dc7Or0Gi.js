import{j as t}from"./vendor-ui-DPGpZYCr.js";import{j as R,f as M,r as o}from"./vendor-react-CpsyMv2-.js";import{l as G,u as P,s as N,o as r,g as B}from"./index-Dy8cuphJ.js";import{M as O}from"./MultiTagSelector-b1_Xs0G4.js";import{C as U,a as $}from"./card-C2l9iz4D.js";import{A as J}from"./arrow-left-BQOpDhzu.js";import{S as W}from"./save-y6tr7anu.js";import{C as Y}from"./circle-alert-BjoSExI5.js";import{R as H}from"./refresh-cw-CKrYIAf3.js";import{I as K}from"./image-D1Of3PSK.js";import"./vendor-thirdweb-B1z45yR6.js";import"./input-Bx0OIfR4.js";import"./badge-Qj6g2PQt.js";import"./plus-BKcLXqyR.js";function ct(){const{id:l}=R(),{user:s}=G(),{t:e}=P(),m=M(),[w,y]=o.useState(!0),[u,f]=o.useState(!1),[c,D]=o.useState(null),[n,S]=o.useState(""),[d,h]=o.useState(""),[E,b]=o.useState(""),[p,A]=o.useState(""),[k,I]=o.useState("ai_tools"),[_,F]=o.useState([]),[v,C]=o.useState(!1),[j,x]=o.useState("");o.useEffect(()=>{l&&s&&T()},[l,s]);const T=async()=>{try{y(!0);const{data:a,error:g}=await N.from("stories").select("*").eq("id",l).single();if(g)throw g;if(a.author!==(s==null?void 0:s.id)){r.error(e("story.not_authorized","You are not authorized to edit this story")),m("/stories");return}D(a),S(a.title||""),h(a.content||""),b(a.excerpt||""),A(a.featured_image_url||""),I(a.category||"ai_tools")}catch(a){console.error("Error loading story:",a),r.error(e("story.load_error","Failed to load story")),m("/stories")}finally{y(!1)}},z=async()=>{if(!n.trim()){r.error(e("story.title_required_for_image","Please enter a title first"));return}C(!0);try{const a=`Professional illustration for article titled: "${n}". Modern, clean, high-quality, suitable for business publication.`,i=await(await fetch("/api/generate-avatar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:a,size:"1024x1024"})})).json();if(i.success&&(i.base64Image||i.imageUrl)){const q=i.base64Image||i.imageUrl;A(q),r.success(e("story.image_generated","Image generated successfully"))}else throw new Error("Failed to generate image")}catch(a){console.error("Error generating image:",a),r.error(e("story.image_error","Failed to generate image"))}finally{C(!1)}},L=async()=>{if(!(!s||!c)){if(!n.trim()||!d.trim()){x(e("story.required_fields","Title and content are required"));return}f(!0),x("");try{const{error:a}=await N.from("stories").update({title:n.trim(),content:d.trim(),excerpt:E.trim()||d.trim().substring(0,200),featured_image_url:p||null,category:k,updated_at:new Date().toISOString()}).eq("id",c.id);if(a)throw a;r.success(e("story.updated","Story updated successfully!")),m(`/story/${c.id}`)}catch(a){console.error("Error updating story:",a),x(a.message||e("story.update_error","Failed to update story")),r.error(a.message||e("story.update_error","Failed to update story"))}finally{f(!1)}}};return w?t.jsx("div",{className:"flex items-center justify-center min-h-screen","data-matrix-id":"src/pages/EditStory.tsx:166:6","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"166","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22flex%20items-center%20justify-center%20min-h-screen%22%7D",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500","data-matrix-id":"src/pages/EditStory.tsx:167:8","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"167","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22animate-spin%20rounded-full%20h-12%20w-12%20border-b-2%20border-primary-500%22%7D"})}):c?t.jsx("div",{className:"min-h-screen bg-background py-8","data-matrix-id":"src/pages/EditStory.tsx:177:4","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"177","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22min-h-screen%20bg-background%20py-8%22%7D",children:t.jsxs("div",{className:"max-w-4xl mx-auto px-4","data-matrix-id":"src/pages/EditStory.tsx:178:6","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"178","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22max-w-4xl%20mx-auto%20px-4%22%7D",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6","data-matrix-id":"src/pages/EditStory.tsx:180:8","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"180","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22flex%20items-center%20justify-between%20mb-6%22%7D",children:[t.jsxs("button",{onClick:()=>m(-1),className:"flex items-center space-x-2 text-foreground-secondary hover:text-foreground transition-colors","data-matrix-id":"src/pages/EditStory.tsx:181:10","data-matrix-name":"button","data-component-path":"src/pages/EditStory.tsx","data-component-line":"181","data-component-file":"EditStory.tsx","data-component-name":"button","data-component-content":"%7B%22onClick%22%3A%22%5BArrowFunctionExpression%5D%22%2C%22className%22%3A%22flex%20items-center%20space-x-2%20text-foreground-secondary%20hover%3Atext-foreground%20transition-colors%22%7D",children:[t.jsx(J,{size:20,"data-matrix-id":"src/pages/EditStory.tsx:185:12","data-matrix-name":"ArrowLeft","data-component-path":"src/pages/EditStory.tsx","data-component-line":"185","data-component-file":"EditStory.tsx","data-component-name":"ArrowLeft","data-component-content":"%7B%22size%22%3A20%7D"}),t.jsx("span",{"data-matrix-id":"src/pages/EditStory.tsx:186:12","data-matrix-name":"span","data-component-path":"src/pages/EditStory.tsx","data-component-line":"186","data-component-file":"EditStory.tsx","data-component-name":"span",children:e("common.back","Back")})]}),t.jsx("div",{className:"flex items-center space-x-3","data-matrix-id":"src/pages/EditStory.tsx:189:10","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"189","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22flex%20items-center%20space-x-3%22%7D",children:t.jsx(B,{onClick:L,disabled:u||!n.trim()||!d.trim(),className:"flex items-center space-x-2","data-matrix-id":"src/pages/EditStory.tsx:190:12","data-matrix-name":"Button","data-component-path":"src/pages/EditStory.tsx","data-component-line":"190","data-component-file":"EditStory.tsx","data-component-name":"Button","data-component-content":"%7B%22onClick%22%3A%22%5BIdentifier%5D%22%2C%22disabled%22%3A%22%5BLogicalExpression%5D%22%2C%22className%22%3A%22flex%20items-center%20space-x-2%22%7D",children:u?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent","data-matrix-id":"src/pages/EditStory.tsx:197:18","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"197","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22animate-spin%20rounded-full%20h-4%20w-4%20border-2%20border-white%20border-t-transparent%22%7D"}),t.jsx("span",{"data-matrix-id":"src/pages/EditStory.tsx:198:18","data-matrix-name":"span","data-component-path":"src/pages/EditStory.tsx","data-component-line":"198","data-component-file":"EditStory.tsx","data-component-name":"span",children:e("story.saving","Saving...")})]}):t.jsxs(t.Fragment,{children:[t.jsx(W,{className:"w-4 h-4","data-matrix-id":"src/pages/EditStory.tsx:202:18","data-matrix-name":"Save","data-component-path":"src/pages/EditStory.tsx","data-component-line":"202","data-component-file":"EditStory.tsx","data-component-name":"Save","data-component-content":"%7B%22className%22%3A%22w-4%20h-4%22%7D"}),t.jsx("span",{"data-matrix-id":"src/pages/EditStory.tsx:203:18","data-matrix-name":"span","data-component-path":"src/pages/EditStory.tsx","data-component-line":"203","data-component-file":"EditStory.tsx","data-component-name":"span",children:e("story.save_changes","Save Changes")})]})})})]}),j&&t.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start space-x-3","data-matrix-id":"src/pages/EditStory.tsx:212:10","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"212","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22mb-6%20p-4%20bg-red-50%20dark%3Abg-red-900%2F20%20border%20border-red-200%20dark%3Aborder-red-800%20rounded-lg%20flex%20items-start%20space-x-3%22%7D",children:[t.jsx(Y,{className:"text-red-600 mt-0.5 flex-shrink-0",size:20,"data-matrix-id":"src/pages/EditStory.tsx:213:12","data-matrix-name":"AlertCircle","data-component-path":"src/pages/EditStory.tsx","data-component-line":"213","data-component-file":"EditStory.tsx","data-component-name":"AlertCircle","data-component-content":"%7B%22className%22%3A%22text-red-600%20mt-0.5%20flex-shrink-0%22%2C%22size%22%3A20%7D"}),t.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm","data-matrix-id":"src/pages/EditStory.tsx:214:12","data-matrix-name":"p","data-component-path":"src/pages/EditStory.tsx","data-component-line":"214","data-component-file":"EditStory.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-red-600%20dark%3Atext-red-400%20text-sm%22%7D",children:j})]}),t.jsx(U,{"data-matrix-id":"src/pages/EditStory.tsx:219:8","data-matrix-name":"Card","data-component-path":"src/pages/EditStory.tsx","data-component-line":"219","data-component-file":"EditStory.tsx","data-component-name":"Card",children:t.jsxs($,{className:"p-6 space-y-6","data-matrix-id":"src/pages/EditStory.tsx:220:10","data-matrix-name":"CardContent","data-component-path":"src/pages/EditStory.tsx","data-component-line":"220","data-component-file":"EditStory.tsx","data-component-name":"CardContent","data-component-content":"%7B%22className%22%3A%22p-6%20space-y-6%22%7D",children:[t.jsxs("div",{"data-matrix-id":"src/pages/EditStory.tsx:222:12","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"222","data-component-file":"EditStory.tsx","data-component-name":"div",children:[t.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2","data-matrix-id":"src/pages/EditStory.tsx:223:14","data-matrix-name":"label","data-component-path":"src/pages/EditStory.tsx","data-component-line":"223","data-component-file":"EditStory.tsx","data-component-name":"label","data-component-content":"%7B%22className%22%3A%22block%20text-sm%20font-medium%20text-foreground%20mb-2%22%7D",children:[e("story.title","Title")," *"]}),t.jsx("input",{type:"text",value:n,onChange:a=>S(a.target.value),className:"w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-background text-foreground",placeholder:e("story.title_placeholder","Enter story title..."),maxLength:200,"data-matrix-id":"src/pages/EditStory.tsx:226:14","data-matrix-name":"input","data-component-path":"src/pages/EditStory.tsx","data-component-line":"226","data-component-file":"EditStory.tsx","data-component-name":"input","data-component-content":"%7B%22type%22%3A%22text%22%2C%22value%22%3A%22%5BIdentifier%5D%22%2C%22onChange%22%3A%22%5BArrowFunctionExpression%5D%22%2C%22className%22%3A%22w-full%20px-4%20py-2%20border%20border-border%20rounded-lg%20focus%3Aring-2%20focus%3Aring-primary-500%20focus%3Aborder-transparent%20bg-background%20text-foreground%22%2C%22placeholder%22%3A%22%5BCallExpression%5D%22%2C%22maxLength%22%3A200%7D"})]}),t.jsxs("div",{"data-matrix-id":"src/pages/EditStory.tsx:237:12","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"237","data-component-file":"EditStory.tsx","data-component-name":"div",children:[t.jsx("label",{className:"block text-sm font-medium text-foreground mb-2","data-matrix-id":"src/pages/EditStory.tsx:238:14","data-matrix-name":"label","data-component-path":"src/pages/EditStory.tsx","data-component-line":"238","data-component-file":"EditStory.tsx","data-component-name":"label","data-component-content":"%7B%22className%22%3A%22block%20text-sm%20font-medium%20text-foreground%20mb-2%22%7D",children:e("story.excerpt","Excerpt")}),t.jsx("textarea",{value:E,onChange:a=>b(a.target.value),rows:2,className:"w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none bg-background text-foreground",placeholder:e("story.excerpt_placeholder","Brief description (optional)..."),maxLength:300,"data-matrix-id":"src/pages/EditStory.tsx:241:14","data-matrix-name":"textarea","data-component-path":"src/pages/EditStory.tsx","data-component-line":"241","data-component-file":"EditStory.tsx","data-component-name":"textarea","data-component-content":"%7B%22value%22%3A%22%5BIdentifier%5D%22%2C%22onChange%22%3A%22%5BArrowFunctionExpression%5D%22%2C%22rows%22%3A2%2C%22className%22%3A%22w-full%20px-4%20py-2%20border%20border-border%20rounded-lg%20focus%3Aring-2%20focus%3Aring-primary-500%20focus%3Aborder-transparent%20resize-none%20bg-background%20text-foreground%22%2C%22placeholder%22%3A%22%5BCallExpression%5D%22%2C%22maxLength%22%3A300%7D"})]}),t.jsxs("div",{"data-matrix-id":"src/pages/EditStory.tsx:252:12","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"252","data-component-file":"EditStory.tsx","data-component-name":"div",children:[t.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2","data-matrix-id":"src/pages/EditStory.tsx:253:14","data-matrix-name":"label","data-component-path":"src/pages/EditStory.tsx","data-component-line":"253","data-component-file":"EditStory.tsx","data-component-name":"label","data-component-content":"%7B%22className%22%3A%22block%20text-sm%20font-medium%20text-foreground%20mb-2%22%7D",children:[e("story.content","Content")," *"]}),t.jsx("textarea",{value:d,onChange:a=>h(a.target.value),rows:15,className:"w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none bg-background text-foreground font-mono text-sm",placeholder:e("story.content_placeholder","Write your story content here..."),"data-matrix-id":"src/pages/EditStory.tsx:256:14","data-matrix-name":"textarea","data-component-path":"src/pages/EditStory.tsx","data-component-line":"256","data-component-file":"EditStory.tsx","data-component-name":"textarea","data-component-content":"%7B%22value%22%3A%22%5BIdentifier%5D%22%2C%22onChange%22%3A%22%5BArrowFunctionExpression%5D%22%2C%22rows%22%3A15%2C%22className%22%3A%22w-full%20px-4%20py-2%20border%20border-border%20rounded-lg%20focus%3Aring-2%20focus%3Aring-primary-500%20focus%3Aborder-transparent%20resize-none%20bg-background%20text-foreground%20font-mono%20text-sm%22%2C%22placeholder%22%3A%22%5BCallExpression%5D%22%7D"})]}),t.jsxs("div",{"data-matrix-id":"src/pages/EditStory.tsx:266:12","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"266","data-component-file":"EditStory.tsx","data-component-name":"div",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2","data-matrix-id":"src/pages/EditStory.tsx:267:14","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"267","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22flex%20items-center%20justify-between%20mb-2%22%7D",children:[t.jsx("label",{className:"block text-sm font-medium text-foreground","data-matrix-id":"src/pages/EditStory.tsx:268:16","data-matrix-name":"label","data-component-path":"src/pages/EditStory.tsx","data-component-line":"268","data-component-file":"EditStory.tsx","data-component-name":"label","data-component-content":"%7B%22className%22%3A%22block%20text-sm%20font-medium%20text-foreground%22%7D",children:e("story.featured_image","Featured Image")}),t.jsx(B,{type:"button",variant:"outline",size:"sm",onClick:z,disabled:v||!n.trim(),"data-matrix-id":"src/pages/EditStory.tsx:271:16","data-matrix-name":"Button","data-component-path":"src/pages/EditStory.tsx","data-component-line":"271","data-component-file":"EditStory.tsx","data-component-name":"Button","data-component-content":"%7B%22type%22%3A%22button%22%2C%22variant%22%3A%22outline%22%2C%22size%22%3A%22sm%22%2C%22onClick%22%3A%22%5BIdentifier%5D%22%2C%22disabled%22%3A%22%5BLogicalExpression%5D%22%7D",children:v?t.jsxs(t.Fragment,{children:[t.jsx(H,{className:"w-4 h-4 mr-2 animate-spin","data-matrix-id":"src/pages/EditStory.tsx:280:22","data-matrix-name":"RefreshCw","data-component-path":"src/pages/EditStory.tsx","data-component-line":"280","data-component-file":"EditStory.tsx","data-component-name":"RefreshCw","data-component-content":"%7B%22className%22%3A%22w-4%20h-4%20mr-2%20animate-spin%22%7D"}),e("story.generating","Generating...")]}):t.jsxs(t.Fragment,{children:[t.jsx(K,{className:"w-4 h-4 mr-2","data-matrix-id":"src/pages/EditStory.tsx:285:22","data-matrix-name":"ImageIcon","data-component-path":"src/pages/EditStory.tsx","data-component-line":"285","data-component-file":"EditStory.tsx","data-component-name":"ImageIcon","data-component-content":"%7B%22className%22%3A%22w-4%20h-4%20mr-2%22%7D"}),p?e("story.regenerate_image","Regenerate"):e("story.generate_image","Generate with AI")]})})]}),p&&t.jsx("div",{className:"mt-2 rounded-lg overflow-hidden border border-border","data-matrix-id":"src/pages/EditStory.tsx:292:16","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"292","data-component-file":"EditStory.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22mt-2%20rounded-lg%20overflow-hidden%20border%20border-border%22%7D",children:t.jsx("img",{src:p,alt:"Featured",className:"w-full h-auto max-h-64 object-cover","data-matrix-id":"src/pages/EditStory.tsx:293:18","data-matrix-name":"img","data-component-path":"src/pages/EditStory.tsx","data-component-line":"293","data-component-file":"EditStory.tsx","data-component-name":"img","data-component-content":"%7B%22src%22%3A%22%5BIdentifier%5D%22%2C%22alt%22%3A%22Featured%22%2C%22className%22%3A%22w-full%20h-auto%20max-h-64%20object-cover%22%7D"})})]}),t.jsxs("div",{"data-matrix-id":"src/pages/EditStory.tsx:303:12","data-matrix-name":"div","data-component-path":"src/pages/EditStory.tsx","data-component-line":"303","data-component-file":"EditStory.tsx","data-component-name":"div",children:[t.jsx("label",{className:"block text-sm font-medium text-foreground mb-2","data-matrix-id":"src/pages/EditStory.tsx:304:14","data-matrix-name":"label","data-component-path":"src/pages/EditStory.tsx","data-component-line":"304","data-component-file":"EditStory.tsx","data-component-name":"label","data-component-content":"%7B%22className%22%3A%22block%20text-sm%20font-medium%20text-foreground%20mb-2%22%7D",children:e("story.tags","Tags")}),t.jsx(O,{selectedTags:_,onTagsChange:F,maxTags:3,"data-matrix-id":"src/pages/EditStory.tsx:307:14","data-matrix-name":"MultiTagSelector","data-component-path":"src/pages/EditStory.tsx","data-component-line":"307","data-component-file":"EditStory.tsx","data-component-name":"MultiTagSelector","data-component-content":"%7B%22selectedTags%22%3A%22%5BIdentifier%5D%22%2C%22onTagsChange%22%3A%22%5BIdentifier%5D%22%2C%22maxTags%22%3A3%7D"})]})]})})]})}):null}export{ct as default};
