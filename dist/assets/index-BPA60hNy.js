const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/in-app-wallet-calls-Dl5w4L9t.js","assets/vendor-thirdweb-B1z45yR6.js"])))=>i.map(i=>d[i]);
import{aa as S,Z as B,_ as L,ab as ct,N as ot,ac as W,ad as z,A as K,ae as F,af as x,ag as D,a0 as j,a3 as C,M as dt,s as Z,b as _,ah as R,e as k,r as O,ai as mt,aj as pt,ak as ut,y as v,al as Y,am as yt,an as lt,R as ft,ao as wt,ap as J,aq as Q,x as At,z as Gt,ar as gt,as as ht,g as X,f as E,p as V,at as tt,au as Tt,$ as Pt,I as vt,J as Lt}from"./vendor-thirdweb-B1z45yR6.js";import{o as at,h as Ot,a as xt,b as Dt,c as Ct,d as U,f as St,i as _t,j as Ft}from"./bundler-De8BusCB.js";import{t as Et,p as Vt,s as Ut}from"./send-eip712-transaction-D0LhmJhm.js";import{p as It}from"./Auth-D--Fh304.js";import"./vendor-ui-DPGpZYCr.js";import"./vendor-react-CpsyMv2-.js";import"./index-Dy8cuphJ.js";import"./mail-2b8o2FGV.js";import"./eye-off-5dQQKzLU.js";import"./eye-CStPiHBG.js";import"./circle-alert-BjoSExI5.js";import"./loader-circle-C2IDBDno.js";const bt="0xdd62ed3e",Nt=[{name:"owner",type:"address"},{name:"spender",type:"address"}],$t=[{type:"uint256"}];async function Rt(a){return S({contract:a.contract,method:[bt,Nt,$t],params:[a.owner,a.spender]})}const kt="0x095ea7b3",Ht=[{name:"spender",type:"address"},{name:"value",type:"uint256"}],Mt=[{type:"bool"}];function qt(a){const e=at(async()=>"asyncParams"in a?await a.asyncParams():a);return B({accessList:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.accessList},authorizationList:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.authorizationList},contract:a.contract,erc20Value:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.erc20Value},extraGas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.extraGas},gas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.maxPriorityFeePerGas},method:[kt,Ht,Mt],nonce:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.nonce},params:async()=>{const t=await e();return[t.spender,t.value]},value:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.value}})}function Bt(a){return qt({asyncParams:async()=>{let e;if("amount"in a){const{decimals:t}=await L(async()=>{const{decimals:r}=await import("./vendor-thirdweb-B1z45yR6.js").then(n=>n.aK);return{decimals:r}},[]),i=await t(a).catch(()=>18);e=ct(a.amount.toString(),i)}else e=a.amountWei;return{overrides:{erc20Value:{amountWei:e,tokenAddress:a.contract.address},...a.overrides},spender:a.spender,value:e}},contract:a.contract})}const Wt="0xf15d424e",zt=[{name:"signer",type:"address"}],Kt=[{components:[{name:"signer",type:"address"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"startTimestamp",type:"uint128"},{name:"endTimestamp",type:"uint128"}],name:"permissions",type:"tuple"}];async function jt(a){return S({contract:a.contract,method:[Wt,zt,Kt],params:[a.signer]})}const Zt="0x5892e236",Yt=[{components:[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],name:"req",type:"tuple"},{name:"signature",type:"bytes"}],Jt=[];function Qt(a){const e=at(async()=>"asyncParams"in a?await a.asyncParams():a);return B({accessList:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.accessList},authorizationList:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.authorizationList},contract:a.contract,erc20Value:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.erc20Value},extraGas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.extraGas},gas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.maxPriorityFeePerGas},method:[Zt,Yt,Jt],nonce:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.nonce},params:async()=>{const t=await e();return[t.req,t.signature]},value:async()=>{var t;return(t=(await e()).overrides)==null?void 0:t.value}})}function q(){return new Date(Date.now()+1e3*60*60*24*365*10)}function b(a){return Et(Math.floor(a.getTime()/1e3))}const Xt=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function ta(a){const{account:e,contract:t,req:i}=a,r=await e.signTypedData({domain:{chainId:t.chain.id,name:"Account",verifyingContract:t.address,version:"1"},message:i,primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:Xt}});return{req:i,signature:r}}async function aa(a){var i;const{target:e,permissions:t}=a;return{approvedTargets:t.approvedTargets==="*"?[z]:t.approvedTargets,isAdmin:0,nativeTokenLimitPerTransaction:W(((i=t.nativeTokenLimitPerTransaction)==null?void 0:i.toString())||"0"),permissionEndTimestamp:b(t.permissionEndTimestamp||q()),permissionStartTimestamp:b(t.permissionStartTimestamp||new Date(0)),reqValidityEndTimestamp:b(q()),reqValidityStartTimestamp:0n,signer:e,uid:await ot()}}function ea(a){const{contract:e,sessionKeyAddress:t,account:i,permissions:r}=a;return Qt({async asyncParams(){const{req:n,signature:c}=await ta({account:i,contract:e,req:await aa({permissions:r,target:t})});return{req:n,signature:c}},contract:e})}async function sa(a){var c;const{accountContract:e,sessionKeyAddress:t,newPermissions:i}=a;if(!await K(e))return!0;const n=await jt({contract:e,signer:t});return!!(n.endTimestamp&&n.endTimestamp<Math.floor(Date.now()/1e3)||!na(n.approvedTargets,i.approvedTargets)||W(((c=i.nativeTokenLimitPerTransaction)==null?void 0:c.toString())??"0")>n.nativeTokenLimitPerTransaction)}function na(a,e){return e==="*"&&a.length===1&&a[0]===z?!0:e!=="*"?e.map(t=>t.toLowerCase()).every(t=>a.map(i=>i.toLowerCase()).includes(t)):!1}const ra=2n**96n-1n,ia="0x35567e1a",ca=[{name:"sender",type:"address"},{name:"key",type:"uint192"}],oa=[{name:"nonce",type:"uint256"}];async function da(a){return S({contract:a.contract,method:[ia,ca,oa],params:[a.sender,a.key]})}const ma="0xa6193531",pa=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],ua=[{type:"bytes32"}];async function ya(a){return S({contract:a.contract,method:[ma,pa,ua],params:[a.userOp]})}const la="0x22cdde4c",fa=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"accountGasLimits",type:"bytes32"},{name:"preVerificationGas",type:"uint256"},{name:"gasFees",type:"bytes32"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],wa=[{type:"bytes32"}];async function Aa(a){return S({contract:a.contract,method:[la,fa,wa],params:[a.userOp]})}function Ga(a){return a.factory?F([a.factory,a.factoryData||"0x"]):"0x"}function ga(a){return F([x(D(BigInt(a.verificationGasLimit)),{size:16}),x(D(BigInt(a.callGasLimit)),{size:16})])}function ha(a){return F([x(D(BigInt(a.maxPriorityFeePerGas)),{size:16}),x(D(BigInt(a.maxFeePerGas)),{size:16})])}function Ta(a){return a.paymaster?F([a.paymaster,x(D(BigInt(a.paymasterVerificationGasLimit||0)),{size:16}),x(D(BigInt(a.paymasterPostOpGasLimit||0)),{size:16}),a.paymasterData||"0x"]):"0x"}const Pa=a=>({accountGasLimits:ga(a),callData:a.callData,gasFees:ha(a),initCode:Ga(a),nonce:BigInt(a.nonce),paymasterAndData:Ta(a),preVerificationGas:BigInt(a.preVerificationGas),sender:a.sender,signature:a.signature});async function I(a){var A;const{userOp:e,paymasterOverride:t,client:i,chain:r,entrypointAddress:n}=a;if(t)return t(e);const c={"Content-Type":"application/json"},s=n??C,o=j(r),d={id:1,jsonrpc:"2.0",method:"pm_sponsorUserOperation",params:[Ot(e),s]},l=await dt(i)(o,{body:Z(d),headers:c,method:"POST"});if(!l.ok){const G=await l.text()||l.statusText;throw new Error(`Paymaster error: ${l.status} - ${G}`)}const p=await l.json();if(p.result)return typeof p.result=="string"?{paymasterAndData:p.result}:(p.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${p.result.reason} ${p.result.policyId?`(policyId: ${p.result.policyId})`:""}`),{callGasLimit:p.result.callGasLimit?_(p.result.callGasLimit):void 0,paymaster:p.result.paymaster,paymasterAndData:p.result.paymasterAndData,paymasterData:p.result.paymasterData,paymasterPostOpGasLimit:p.result.paymasterPostOpGasLimit?_(p.result.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:p.result.paymasterVerificationGasLimit?_(p.result.paymasterVerificationGasLimit):void 0,preVerificationGas:p.result.preVerificationGas?_(p.result.preVerificationGas):void 0,verificationGasLimit:p.result.verificationGasLimit?_(p.result.verificationGasLimit):void 0});const w=((A=p.error)==null?void 0:A.message)||p.error||l.statusText||"unknown error";throw new Error(`Paymaster error from ${o}: ${w}`)}const H=new Set,M=a=>`${a.chain.id}:${a.address}`,et=a=>{H.add(M(a))},st=a=>{H.delete(M(a))},nt=a=>H.has(M(a));async function va(a){const e=a.timeoutMs||12e4,t=a.intervalMs||1e3,i=Date.now()+e;for(;Date.now()<i;){const r=await xt(a);if(r)return r;await new Promise(n=>setTimeout(n,t))}throw new Error(`Timeout waiting for userOp to be mined on chain ${a.chain.id} with UserOp hash: ${a.userOpHash}`)}async function La(a){var T;const{transaction:e,accountContract:t,factoryContract:i,adminAddress:r,overrides:n,sponsorGas:c,waitForDeployment:s=!0,isDeployedOverride:o}=a,d=e.chain,y=e.client,l={bundlerUrl:n==null?void 0:n.bundlerUrl,chain:d,client:y,entrypointAddress:n==null?void 0:n.entrypointAddress},p=R(((T=a.overrides)==null?void 0:T.entrypointAddress)||C),[w,A,G,g,f]=await Promise.all([typeof o=="boolean"?o:K(t).then(h=>h||nt(t)),k(e),O(e.gas),Oa({bundlerOptions:l,chain:d,client:y,executeTx:e}),Fa({accountContract:t,chain:d,client:y,entrypointAddress:n==null?void 0:n.entrypointAddress,getNonceOverride:n==null?void 0:n.getAccountNonce})]),{maxFeePerGas:m,maxPriorityFeePerGas:u}=g;return p==="v0.7"?xa({accountContract:t,adminAddress:r,bundlerOptions:l,callData:A,callGasLimit:G,factoryContract:i,isDeployed:w,maxFeePerGas:m,maxPriorityFeePerGas:u,nonce:f,overrides:n,sponsorGas:c,waitForDeployment:s}):Da({accountContract:t,adminAddress:r,bundlerOptions:l,callData:A,callGasLimit:G,factoryContract:i,isDeployed:w,maxFeePerGas:m,maxPriorityFeePerGas:u,nonce:f,overrides:n,sponsorGas:c,waitForDeployment:s})}async function Oa(a){const{executeTx:e,bundlerOptions:t,chain:i,client:r}=a;let{maxFeePerGas:n,maxPriorityFeePerGas:c}=e;const s=(t==null?void 0:t.bundlerUrl)??j(i);if(pt(s)){const o=await Dt({options:t});n=o.maxFeePerGas,c=o.maxPriorityFeePerGas}else{const[o,d]=await Promise.all([O(n),O(c)]);if(o&&d)n=o,c=d;else{const y=await ut(r,i);c=d??y.maxPriorityFeePerGas??0n,n=o??y.maxFeePerGas??0n}}return{maxFeePerGas:n,maxPriorityFeePerGas:c}}async function xa(a){const{bundlerOptions:e,isDeployed:t,factoryContract:i,accountContract:r,adminAddress:n,sponsorGas:c,overrides:s,nonce:o,callData:d,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:p,waitForDeployment:w}=a,{chain:A,client:G}=e;let g,f;t?(f="0x",w&&await rt(r)):(g=i.address,f=await k(Y({accountSalt:s==null?void 0:s.accountSalt,adminAddress:n,createAccountOverride:s==null?void 0:s.createAccount,factoryContract:i})),w&&et(r));const m={callData:d,callGasLimit:y??0n,factory:g,factoryData:f,maxFeePerGas:l,maxPriorityFeePerGas:p,nonce:o,paymaster:void 0,paymasterData:"0x",paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n,preVerificationGas:0n,sender:r.address,signature:J,verificationGasLimit:0n};if(c){const u=await I({chain:A,client:G,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:m});if(u.paymaster&&u.paymasterData&&(m.paymaster=u.paymaster,m.paymasterData=u.paymasterData),u.callGasLimit&&u.verificationGasLimit&&u.preVerificationGas&&u.paymasterPostOpGasLimit&&u.paymasterVerificationGasLimit)m.callGasLimit=u.callGasLimit,m.verificationGasLimit=u.verificationGasLimit,m.preVerificationGas=u.preVerificationGas,m.paymasterPostOpGasLimit=u.paymasterPostOpGasLimit,m.paymasterVerificationGasLimit=u.paymasterVerificationGasLimit;else{const T=s!=null&&s.tokenPaymaster?{[s.tokenPaymaster.tokenAddress]:{stateDiff:{[yt(lt([{type:"address"},{type:"uint256"}],[r.address,s.tokenPaymaster.balanceStorageSlot]))]:ft(wt,{size:32})}}}:void 0,h=await U({options:e,userOp:m},T);m.callGasLimit=h.callGasLimit,m.verificationGasLimit=h.verificationGasLimit,m.preVerificationGas=h.preVerificationGas,m.paymasterPostOpGasLimit=s!=null&&s.tokenPaymaster?500000n:h.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n;const P=await I({chain:A,client:G,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:m});P.paymaster&&P.paymasterData&&(m.paymaster=P.paymaster,m.paymasterData=P.paymasterData)}}else{const u=await U({options:e,userOp:m});m.callGasLimit=u.callGasLimit,m.verificationGasLimit=u.verificationGasLimit,m.preVerificationGas=u.preVerificationGas,m.paymasterPostOpGasLimit=u.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=u.paymasterVerificationGasLimit||0n}return{...m,signature:"0x"}}async function Da(a){const{bundlerOptions:e,isDeployed:t,factoryContract:i,accountContract:r,adminAddress:n,sponsorGas:c,overrides:s,nonce:o,callData:d,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:p,waitForDeployment:w}=a,{chain:A,client:G}=e;let g;t?(g="0x",w&&await rt(r)):(g=await _a({accountSalt:s==null?void 0:s.accountSalt,adminAddress:n,createAccountOverride:s==null?void 0:s.createAccount,factoryContract:i}),w&&et(r));const f={callData:d,callGasLimit:y??0n,initCode:g,maxFeePerGas:l,maxPriorityFeePerGas:p,nonce:o,paymasterAndData:"0x",preVerificationGas:0n,sender:r.address,signature:J,verificationGasLimit:0n};if(c){const m=await I({chain:A,client:G,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:f}),u="paymasterAndData"in m?m.paymasterAndData:"0x";if(u&&u!=="0x"&&(f.paymasterAndData=u),m.callGasLimit&&m.verificationGasLimit&&m.preVerificationGas)f.callGasLimit=m.callGasLimit,f.verificationGasLimit=m.verificationGasLimit,f.preVerificationGas=m.preVerificationGas;else{const T=await U({options:e,userOp:f});if(f.callGasLimit=T.callGasLimit,f.verificationGasLimit=T.verificationGasLimit,f.preVerificationGas=T.preVerificationGas,u&&u!=="0x"){const h=await I({chain:A,client:G,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster,userOp:f}),P="paymasterAndData"in h?h.paymasterAndData:"0x";P&&P!=="0x"&&(f.paymasterAndData=P)}}}else{const m=await U({options:e,userOp:f});f.callGasLimit=m.callGasLimit,f.verificationGasLimit=m.verificationGasLimit,f.preVerificationGas=m.preVerificationGas}return{...f,signature:"0x"}}async function Ca(a){const{userOp:e,chain:t,entrypointAddress:i,adminAccount:r}=a,n=await Sa({chain:t,client:a.client,entrypointAddress:i,userOp:e});if(r.signMessage){const c=await r.signMessage({chainId:t.id,message:{raw:mt(n)},originalMessage:Z(e)});return{...e,signature:c}}throw new Error("signMessage not implemented in signingAccount")}async function Sa(a){const{userOp:e,chain:t,entrypointAddress:i}=a,r=R(i||C);let n;if(r==="v0.7"){const c=Pa(e);n=await Aa({contract:v({address:i||Q,chain:t,client:a.client}),userOp:c})}else n=await ya({contract:v({address:i||C,chain:t,client:a.client}),userOp:e});return n}async function _a(a){const{factoryContract:e,adminAddress:t,accountSalt:i,createAccountOverride:r}=a,n=Y({accountSalt:i,adminAddress:t,createAccountOverride:r,factoryContract:e});return F([e.address,await k(n)])}async function Fa(a){const{accountContract:e,chain:t,client:i,entrypointAddress:r,getNonceOverride:n}=a;return n?n(e):await da({contract:v({address:r||C,chain:t,client:i}),key:Ct(),sender:e.address})}async function rt(a){const e=Date.now();for(;nt(a);){if(Date.now()-e>6e4)throw st(a),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(t=>setTimeout(t,500))}}const it=new WeakMap,N=new WeakMap;async function ja(a,e){var p,w,A,G,g,f,m;const{personalAccount:t,client:i}=a;if(!t)throw new Error("No personal account provided for smart account connection");const r=e,n=e.chain,c="gasless"in r?r.gasless:r.sponsorGas;if(await At(n))return[Ua({chain:n,connectionOptions:a,creationOptions:e,sponsorGas:c}),n];if(r.factoryAddress&&!((p=r.overrides)!=null&&p.entrypointAddress)){const u=await Ia(r.factoryAddress,i,n);u&&(r.overrides={...r.overrides,entrypointAddress:u})}(w=r.overrides)!=null&&w.tokenPaymaster&&!((A=r.overrides)!=null&&A.entrypointAddress)&&(r.overrides={...r.overrides,entrypointAddress:Q});const s=r.factoryAddress??Gt((G=r.overrides)==null?void 0:G.entrypointAddress),o=v({address:s,chain:n,client:i}),d=await gt({accountAddress:(g=r.overrides)==null?void 0:g.accountAddress,accountSalt:(f=r.overrides)==null?void 0:f.accountSalt,adminAddress:t.address,factoryContract:o,predictAddressOverride:(m=r.overrides)==null?void 0:m.predictAddress}).then(u=>u).catch(u=>{throw new Error(`Failed to get account address with factory contract ${o.address} on chain ID ${n.id}: ${(u==null?void 0:u.message)||"unknown error"}`,{cause:u})}),y=v({address:d,chain:n,client:i}),l=await Ea({...r,accountContract:y,chain:n,client:i,factoryContract:o,personalAccount:t,sponsorGas:c});if(it.set(t,l),N.set(l,t),r.sessionKey&&await sa({accountContract:y,newPermissions:r.sessionKey.permissions,sessionKeyAddress:r.sessionKey.address})){const u=ea({account:t,contract:y,permissions:r.sessionKey.permissions,sessionKeyAddress:r.sessionKey.address});await ht({account:l,transaction:u})}return[l,n]}async function Za(a){const e=N.get(a);e&&(it.delete(e),N.delete(a))}async function Ea(a){var n,c;const e=(n=a.overrides)==null?void 0:n.tokenPaymaster;if(e&&R(((c=a.overrides)==null?void 0:c.entrypointAddress)||C)!=="v0.7")throw new Error("Token paymaster is only supported for entrypoint version v0.7");const t=a.sponsorGas;let i=a.accountContract;const r={address:X(i.address),async onTransactionRequested(s){var o,d;return(d=(o=a.personalAccount).onTransactionRequested)==null?void 0:d.call(o,s)},async sendBatchTransaction(s){var p,w;const o=Tt({accountContract:i,executeBatchOverride:(p=a.overrides)==null?void 0:p.executeBatch,transactions:s});if(s.length===0)throw new Error("No transactions to send");const d=s[0];if(!d)throw new Error("No transactions to send");const y=E(d.chainId),l=await $({executeTx:o,options:{...a,accountContract:i,chain:y}});return V({chainId:y.id,client:a.client,contractAddress:((w=s[0])==null?void 0:w.to)??void 0,transactionHash:l.transactionHash,walletAddress:a.accountContract.address,walletType:"smart"}),l},async sendTransaction(s){var p,w,A;let o;if(e){await Va({accountContract:i,erc20Paymaster:e,options:a});const G=async()=>({paymaster:e.paymasterAddress,paymasterData:"0x"});o=((p=a.overrides)==null?void 0:p.paymaster)||G}else o=(w=a.overrides)==null?void 0:w.paymaster;s.chainId!==i.chain.id&&(i=v({address:r.address,chain:E(s.chainId),client:a.client}));const d=tt({accountContract:i,executeOverride:(A=a.overrides)==null?void 0:A.execute,transaction:s}),y=E(s.chainId),l=await $({executeTx:d,options:{...a,accountContract:i,chain:y,overrides:{...a.overrides,paymaster:o}}});return V({chainId:y.id,client:a.client,contractAddress:s.to??void 0,transactionHash:l.transactionHash,walletAddress:a.accountContract.address,walletType:"smart"}),l},async signMessage({message:s}){var d;if((d=a.overrides)!=null&&d.signMessage)return a.overrides.signMessage({accountContract:i,adminAccount:a.personalAccount,factoryContract:a.factoryContract,message:s});const{smartAccountSignMessage:o}=await L(async()=>{const{smartAccountSignMessage:y}=await import("./vendor-thirdweb-B1z45yR6.js").then(l=>l.aL);return{smartAccountSignMessage:y}},[]);return o({accountContract:i,factoryContract:a.factoryContract,message:s,options:a})},async signTypedData(s){var d;if((d=a.overrides)!=null&&d.signTypedData)return a.overrides.signTypedData({accountContract:i,adminAccount:a.personalAccount,factoryContract:a.factoryContract,typedData:s});const{smartAccountSignTypedData:o}=await L(async()=>{const{smartAccountSignTypedData:y}=await import("./vendor-thirdweb-B1z45yR6.js").then(l=>l.aL);return{smartAccountSignTypedData:y}},[]);return o({accountContract:i,factoryContract:a.factoryContract,options:a,typedData:s})},sendCalls:async s=>{const{inAppWalletSendCalls:o}=await L(async()=>{const{inAppWalletSendCalls:w}=await import("./in-app-wallet-calls-Dl5w4L9t.js");return{inAppWalletSendCalls:w}},__vite__mapDeps([0,1])),d=s.calls[0];if(!d)throw new Error("No calls to send");const y=d.client,l=d.chain||s.chain,p=await o({account:r,calls:s.calls});return{chain:l,client:y,id:p}},getCallsStatus:async s=>{const{inAppWalletGetCallsStatus:o}=await L(async()=>{const{inAppWalletGetCallsStatus:d}=await import("./in-app-wallet-calls-Dl5w4L9t.js");return{inAppWalletGetCallsStatus:d}},__vite__mapDeps([0,1]));return o(s)},getCapabilities:async s=>({[s.chainId??1]:{atomic:{status:"supported"},paymasterService:{supported:t??!1}}})};return r}async function Va(a){var y;const{accountContract:e,erc20Paymaster:t,options:i}=a,r=t.tokenAddress,n=v({address:r,chain:e.chain,client:e.client});if(await Rt({contract:n,owner:e.address,spender:t.paymasterAddress})>0n)return;const s=Bt({amountWei:ra-1n,contract:n,spender:t.paymasterAddress}),o=await Pt({from:e.address,transaction:s}),d=tt({accountContract:e,executeOverride:(y=i.overrides)==null?void 0:y.execute,transaction:o});await $({executeTx:d,options:{...i,overrides:{...i.overrides,tokenPaymaster:void 0}}})}function Ua(a){const{creationOptions:e,connectionOptions:t,chain:i}=a,r={address:X(t.personalAccount.address),async onTransactionRequested(n){var c,s;return(s=(c=t.personalAccount).onTransactionRequested)==null?void 0:s.call(c,n)},async sendTransaction(n){var y,l,p,w;const c={chain:E(n.chainId),client:t.client,data:n.data,eip712:n.eip712,to:n.to??void 0,value:n.value??0n};let s=await Vt({account:r,transaction:c});if(a.sponsorGas&&!s.paymaster){const A=await St({options:{bundlerUrl:(y=e.overrides)==null?void 0:y.bundlerUrl,chain:i,client:t.client,entrypointAddress:(l=e.overrides)==null?void 0:l.entrypointAddress},transaction:s});s={...s,...A}}const o=await Ut({account:r,chainId:i.id,eip712Transaction:s}),d=await _t({options:{bundlerUrl:(p=e.overrides)==null?void 0:p.bundlerUrl,chain:i,client:t.client,entrypointAddress:(w=e.overrides)==null?void 0:w.entrypointAddress},signedTransaction:o,transaction:s});return V({chainId:i.id,client:t.client,contractAddress:n.to??void 0,transactionHash:d.transactionHash,walletAddress:r.address,walletType:"smart"}),{chain:i,client:t.client,transactionHash:d.transactionHash}},async signMessage({message:n}){return t.personalAccount.signMessage({message:n})},async signTypedData(n){const c=It(n);return t.personalAccount.signTypedData(c)},sendCalls:async n=>{const{inAppWalletSendCalls:c}=await L(async()=>{const{inAppWalletSendCalls:l}=await import("./in-app-wallet-calls-Dl5w4L9t.js");return{inAppWalletSendCalls:l}},__vite__mapDeps([0,1])),s=n.calls[0];if(!s)throw new Error("No calls to send");const o=s.client,d=s.chain||n.chain,y=await c({account:r,calls:n.calls});return{chain:d,client:o,id:y}},getCallsStatus:async n=>{const{inAppWalletGetCallsStatus:c}=await L(async()=>{const{inAppWalletGetCallsStatus:s}=await import("./in-app-wallet-calls-Dl5w4L9t.js");return{inAppWalletGetCallsStatus:s}},__vite__mapDeps([0,1]));return c(n)},getCapabilities:async n=>({[n.chainId??1]:{atomic:{status:"unsupported"},paymasterService:{supported:a.sponsorGas??!1}}})};return r}async function $(a){var i,r,n;const{executeTx:e,options:t}=a;try{const c=await La({accountContract:t.accountContract,adminAddress:t.personalAccount.address,factoryContract:t.factoryContract,overrides:t.overrides,sponsorGas:t.sponsorGas,transaction:e}),s=await Ca({adminAccount:t.personalAccount,chain:t.chain,client:t.client,entrypointAddress:(i=t.overrides)==null?void 0:i.entrypointAddress,userOp:c}),o={bundlerUrl:(r=t.overrides)==null?void 0:r.bundlerUrl,chain:t.chain,client:t.client,entrypointAddress:(n=t.overrides)==null?void 0:n.entrypointAddress},d=await Ft({options:o,userOp:s}),y=await va({...o,userOpHash:d});return V({chainId:t.chain.id,client:t.client,contractAddress:await O(e.to??void 0),transactionHash:y.transactionHash,walletAddress:t.accountContract.address,walletType:"smart"}),{chain:t.chain,client:t.client,transactionHash:y.transactionHash}}catch(c){throw vt(c)&&Lt({chainId:t.chain.id,client:t.client,contractAddress:await O(e.to??void 0),error:c,transactionValue:await O(e.value),walletAddress:t.accountContract.address}),c}finally{st(t.accountContract)}}async function Ia(a,e,t){const i=v({address:a,chain:t,client:e});try{return await S({contract:i,method:"function entrypoint() public view returns (address)"})}catch{return}}export{ja as connectSmartAccount,Za as disconnectSmartAccount,Ia as getEntrypointFromFactory};
