import{r as n,j as t,d as p,aq as f,s as i}from"./index-CW0o6enZ.js";import{C as v,b as j,c as A,a as N}from"./card-DmazJBpO.js";const C=f("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),m=n.forwardRef(({className:a,variant:s,...o},c)=>t.jsx("div",{ref:c,role:"alert",className:p(C({variant:s}),a),...o,"data-matrix-id":"src/components/ui/alert.tsx:25:2","data-matrix-name":"div","data-component-path":"src/components/ui/alert.tsx","data-component-line":"25","data-component-file":"alert.tsx","data-component-name":"div","data-component-content":"%7B%22role%22%3A%22alert%22%2C%22className%22%3A%22%5BCallExpression%5D%22%2C%22...spread%22%3Atrue%7D"}));m.displayName="Alert";const y=n.forwardRef(({className:a,...s},o)=>t.jsx("h5",{ref:o,className:p("mb-1 font-medium leading-none tracking-tight",a),...s,"data-matrix-id":"src/components/ui/alert.tsx:38:2","data-matrix-name":"h5","data-component-path":"src/components/ui/alert.tsx","data-component-line":"38","data-component-file":"alert.tsx","data-component-name":"h5","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%2C%22...spread%22%3Atrue%7D"}));y.displayName="AlertTitle";const d=n.forwardRef(({className:a,...s},o)=>t.jsx("div",{ref:o,className:p("text-sm [&_p]:leading-relaxed",a),...s,"data-matrix-id":"src/components/ui/alert.tsx:50:2","data-matrix-name":"div","data-component-path":"src/components/ui/alert.tsx","data-component-line":"50","data-component-file":"alert.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22%5BCallExpression%5D%22%2C%22...spread%22%3Atrue%7D"}));d.displayName="AlertDescription";function w(){const[a,s]=n.useState(null),[o,c]=n.useState([]),[x,l]=n.useState(null);n.useEffect(()=>{u()},[]);const u=async()=>{try{const{count:e,error:r}=await i.from("stories").select("*",{count:"exact",head:!0});if(r)throw r;const{count:S,error:g}=await i.from("stories").select("*",{count:"exact",head:!0}).eq("status","published").eq("is_public",!0);if(g)throw g;const{data:h,error:b}=await i.from("stories").select(`
          id,
          title,
          status,
          is_public,
          author,
          created_at
        `).order("created_at",{ascending:!1}).limit(10);if(b)throw b;s({total:e,published:S}),c(h||[])}catch(e){console.error("Database check error:",e),l(e.message)}},D=async()=>{try{const{error:e}=await i.from("stories").update({status:"published",is_public:!0,updated_at:new Date().toISOString()}).or("status.neq.published,is_public.eq.false,status.is.null,is_public.is.null");if(e)throw e;const{error:r}=await i.from("stories").update({author:"8e19098b-ac2a-4ae0-b063-1e21a8dea19d",updated_at:new Date().toISOString()}).is("author",null);if(r)throw r;await u(),alert("Stories已修复！请刷新页面查看。")}catch(e){console.error("Fix error:",e),l(e.message)}};return t.jsx("div",{className:"container mx-auto p-4 space-y-4","data-matrix-id":"src/components/stories/StoriesDebug.tsx:96:4","data-matrix-name":"div","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"96","data-component-file":"StoriesDebug.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22container%20mx-auto%20p-4%20space-y-4%22%7D",children:t.jsxs(v,{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:97:6","data-matrix-name":"Card","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"97","data-component-file":"StoriesDebug.tsx","data-component-name":"Card",children:[t.jsx(j,{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:98:8","data-matrix-name":"CardHeader","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"98","data-component-file":"StoriesDebug.tsx","data-component-name":"CardHeader",children:t.jsx(A,{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:99:10","data-matrix-name":"CardTitle","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"99","data-component-file":"StoriesDebug.tsx","data-component-name":"CardTitle",children:"Stories数据库诊断"})}),t.jsxs(N,{className:"space-y-4","data-matrix-id":"src/components/stories/StoriesDebug.tsx:101:8","data-matrix-name":"CardContent","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"101","data-component-file":"StoriesDebug.tsx","data-component-name":"CardContent","data-component-content":"%7B%22className%22%3A%22space-y-4%22%7D",children:[x&&t.jsx(m,{variant:"destructive","data-matrix-id":"src/components/stories/StoriesDebug.tsx:103:12","data-matrix-name":"Alert","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"103","data-component-file":"StoriesDebug.tsx","data-component-name":"Alert","data-component-content":"%7B%22variant%22%3A%22destructive%22%7D",children:t.jsxs(d,{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:104:14","data-matrix-name":"AlertDescription","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"104","data-component-file":"StoriesDebug.tsx","data-component-name":"AlertDescription",children:["错误: ",x]})}),a&&t.jsxs("div",{className:"space-y-2","data-matrix-id":"src/components/stories/StoriesDebug.tsx:109:12","data-matrix-name":"div","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"109","data-component-file":"StoriesDebug.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22space-y-2%22%7D",children:[t.jsxs("p",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:110:14","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"110","data-component-file":"StoriesDebug.tsx","data-component-name":"p",children:[t.jsx("strong",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:110:17","data-matrix-name":"strong","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"110","data-component-file":"StoriesDebug.tsx","data-component-name":"strong",children:"总Stories数:"})," ",a.total]}),t.jsxs("p",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:111:14","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"111","data-component-file":"StoriesDebug.tsx","data-component-name":"p",children:[t.jsx("strong",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:111:17","data-matrix-name":"strong","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"111","data-component-file":"StoriesDebug.tsx","data-component-name":"strong",children:"已发布且公开的Stories数:"})," ",a.published]}),a.published===0&&a.total>0&&t.jsx(m,{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:114:16","data-matrix-name":"Alert","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"114","data-component-file":"StoriesDebug.tsx","data-component-name":"Alert",children:t.jsxs(d,{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:115:18","data-matrix-name":"AlertDescription","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"115","data-component-file":"StoriesDebug.tsx","data-component-name":"AlertDescription",children:["发现 ",a.total," 个stories，但没有已发布且公开的！",t.jsx("button",{onClick:D,className:"ml-4 px-4 py-2 bg-primary-500 text-white rounded hover:bg-primary-600","data-matrix-id":"src/components/stories/StoriesDebug.tsx:117:20","data-matrix-name":"button","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"117","data-component-file":"StoriesDebug.tsx","data-component-name":"button","data-component-content":"%7B%22onClick%22%3A%22%5BIdentifier%5D%22%2C%22className%22%3A%22ml-4%20px-4%20py-2%20bg-primary-500%20text-white%20rounded%20hover%3Abg-primary-600%22%7D",children:"自动修复"})]})})]}),t.jsxs("div",{className:"mt-4","data-matrix-id":"src/components/stories/StoriesDebug.tsx:129:10","data-matrix-name":"div","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"129","data-component-file":"StoriesDebug.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22mt-4%22%7D",children:[t.jsx("h3",{className:"font-bold mb-2","data-matrix-id":"src/components/stories/StoriesDebug.tsx:130:12","data-matrix-name":"h3","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"130","data-component-file":"StoriesDebug.tsx","data-component-name":"h3","data-component-content":"%7B%22className%22%3A%22font-bold%20mb-2%22%7D",children:"最近的Stories (前10个):"}),t.jsxs("div",{className:"space-y-2","data-matrix-id":"src/components/stories/StoriesDebug.tsx:131:12","data-matrix-name":"div","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"131","data-component-file":"StoriesDebug.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22space-y-2%22%7D",children:[o.map(e=>t.jsxs("div",{className:"p-2 border rounded","data-matrix-id":"src/components/stories/StoriesDebug.tsx:133:16","data-matrix-name":"div","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"133","data-component-file":"StoriesDebug.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22p-2%20border%20rounded%22%7D",children:[t.jsxs("p",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:134:18","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"134","data-component-file":"StoriesDebug.tsx","data-component-name":"p",children:[t.jsx("strong",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:134:21","data-matrix-name":"strong","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"134","data-component-file":"StoriesDebug.tsx","data-component-name":"strong",children:"标题:"})," ",e.title]}),t.jsxs("p",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:135:18","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"135","data-component-file":"StoriesDebug.tsx","data-component-name":"p",children:[t.jsx("strong",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:135:21","data-matrix-name":"strong","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"135","data-component-file":"StoriesDebug.tsx","data-component-name":"strong",children:"状态:"})," ",e.status]}),t.jsxs("p",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:136:18","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"136","data-component-file":"StoriesDebug.tsx","data-component-name":"p",children:[t.jsx("strong",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:136:21","data-matrix-name":"strong","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"136","data-component-file":"StoriesDebug.tsx","data-component-name":"strong",children:"公开:"})," ",e.is_public?"是":"否"]}),t.jsxs("p",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:137:18","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"137","data-component-file":"StoriesDebug.tsx","data-component-name":"p",children:[t.jsx("strong",{"data-matrix-id":"src/components/stories/StoriesDebug.tsx:137:21","data-matrix-name":"strong","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"137","data-component-file":"StoriesDebug.tsx","data-component-name":"strong",children:"作者ID:"})," ",e.author]}),t.jsxs("p",{className:"text-xs text-gray-500","data-matrix-id":"src/components/stories/StoriesDebug.tsx:138:18","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"138","data-component-file":"StoriesDebug.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-xs%20text-gray-500%22%7D",children:["创建于: ",new Date(e.created_at).toLocaleString()]})]},e.id)),o.length===0&&t.jsx("p",{className:"text-gray-500","data-matrix-id":"src/components/stories/StoriesDebug.tsx:141:39","data-matrix-name":"p","data-component-path":"src/components/stories/StoriesDebug.tsx","data-component-line":"141","data-component-file":"StoriesDebug.tsx","data-component-name":"p","data-component-content":"%7B%22className%22%3A%22text-gray-500%22%7D",children:"数据库中没有stories！"})]})]})]})]})})}function _(){return t.jsx("div",{className:"min-h-screen bg-background py-8","data-matrix-id":"src/pages/DebugStories.tsx:5:4","data-matrix-name":"div","data-component-path":"src/pages/DebugStories.tsx","data-component-line":"5","data-component-file":"DebugStories.tsx","data-component-name":"div","data-component-content":"%7B%22className%22%3A%22min-h-screen%20bg-background%20py-8%22%7D",children:t.jsx(w,{"data-matrix-id":"src/pages/DebugStories.tsx:6:6","data-matrix-name":"StoriesDebug","data-component-path":"src/pages/DebugStories.tsx","data-component-line":"6","data-component-file":"DebugStories.tsx","data-component-name":"StoriesDebug"})})}export{_ as default};
