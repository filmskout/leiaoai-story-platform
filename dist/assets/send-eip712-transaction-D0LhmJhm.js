import{u as G,R as c,av as w,P as l,Q as B,g as E,$ as z,r as y,aw as D,ax as v,e as A,ay as S}from"./vendor-thirdweb-B1z45yR6.js";function f(a){if(["string","number"].includes(typeof a)&&!Number.isInteger(Number(a)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${a} of type ${typeof a}`);return a instanceof Uint8Array?BigInt(G(a)):BigInt(a)}const x=(a,t)=>typeof a=="bigint"?t(a):Array.isArray(a)?a.map(e=>x(e,t)):a&&typeof a=="object"?Object.fromEntries(Object.entries(a).map(([e,s])=>[e,x(s,t)])):a,b=50000n,H=a=>{const t=L(a);return{domain:{chainId:a.chainId,name:"zkSync",version:"2"},message:t,primaryType:"Transaction",types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]}}};function L(a){const{gas:t,nonce:e,to:s,from:r,value:i,maxFeePerGas:n,maxPriorityFeePerGas:o,paymaster:m,paymasterInput:u,gasPerPubdata:p,data:d,factoryDeps:g}=a;return{data:d||"0x0",factoryDeps:(g==null?void 0:g.map(P=>c(w(P))))??[],from:BigInt(r),gasLimit:t??0n,gasPerPubdataByteLimit:p??b,maxFeePerGas:n??0n,maxPriorityFeePerGas:o??0n,nonce:e?BigInt(e):0n,paymaster:m?BigInt(m):0n,paymasterInput:u||"0x",to:s?BigInt(s):0n,txType:113n,value:i??0n}}async function O(a){const{account:t,transaction:e}=a,s=await I(a),r=await T({account:t,chainId:e.chain.id,eip712Transaction:s}),i=l(e),n=await B(i,r);return{chain:e.chain,client:e.client,transactionHash:n}}async function T(a){const{account:t,eip712Transaction:e,chainId:s}=a,r=H(e),i=await t.signTypedData({...r});return R({...e,chainId:s,customSignature:i})}async function I(a){const{account:t,transaction:e}=a,{gas:s,maxFeePerGas:r,maxPriorityFeePerGas:i,gasPerPubdata:n}=await F({from:E(t.address),transaction:e});return{...await z({from:t.address,transaction:{...e,gas:s,maxFeePerGas:r,maxPriorityFeePerGas:i}}),...e.eip712,from:t.address,gasPerPubdata:n}}function R(a){const{chainId:t,gas:e,nonce:s,to:r,from:i,value:n,maxFeePerGas:o,maxPriorityFeePerGas:m,customSignature:u,factoryDeps:p,paymaster:d,paymasterInput:g,gasPerPubdata:P,data:h}=a,_=[s?c(s):"0x",m?c(m):"0x",o?c(o):"0x",e?c(e):"0x",r??"0x",n?c(n):"0x",h??"0x0",c(t),c(""),c(""),c(t),i??"0x",P?c(P):c(b),p??[],u??"0x",d&&g?[d,g]:[]];return D(["0x71",v(_)])}async function F(a){const{transaction:t,from:e}=a;let[s,r,i,n]=await Promise.all([y(t.gas),y(t.maxFeePerGas),y(t.maxPriorityFeePerGas),y(t.eip712)]),o=n==null?void 0:n.gasPerPubdata;if(s===void 0||r===void 0||i===void 0){const m=l(t),u=await $({from:e,transaction:t}),p=await m({method:"zks_estimateFee",params:[x(u,c)]});s=f(p.gas_limit)*2n,r=f(p.max_fee_per_gas)*2n,i=f(p.max_priority_fee_per_gas)||1n,o=f(p.gas_per_pubdata_limit)*2n,o<50000n&&(o=50000n)}return{gas:s,gasPerPubdata:o,maxFeePerGas:r,maxPriorityFeePerGas:i}}async function $(a){var m;const{transaction:t,from:e}=a,[s,r,i,n]=await Promise.all([A(t),y(t.to),y(t.value),y(t.eip712)]),o=n==null?void 0:n.gasPerPubdata;return{data:s,eip712Meta:{...n,factoryDeps:(m=n==null?void 0:n.factoryDeps)==null?void 0:m.map(u=>Array.from(S(u))),gasPerPubdata:o||50000n},from:e,gasPerPubdata:o,to:r,type:"0x71",value:i}}const M=Object.freeze(Object.defineProperty({__proto__:null,getZkGasFees:F,populateEip712Transaction:I,sendEip712Transaction:O,signEip712Transaction:T},Symbol.toStringTag,{value:"Module"}));export{M as a,I as p,T as s,f as t};
