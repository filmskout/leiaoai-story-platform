const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-C7NJobZH.js","assets/vendor-react-CpsyMv2-.js","assets/vendor-thirdweb-B1z45yR6.js"])))=>i.map(i=>d[i]);
import{s as D,f as g,_ as K,V as W,g as b,W as X,X as Y,C as B,D as Q,E as Z,o as H,u as x,n as I,p as O}from"./vendor-thirdweb-B1z45yR6.js";import{g as U,n as S,a as v,f as nn,p as an}from"./Auth-D--Fh304.js";import"./vendor-ui-DPGpZYCr.js";import"./vendor-react-CpsyMv2-.js";import"./index-Dy8cuphJ.js";import"./mail-2b8o2FGV.js";import"./eye-off-5dQQKzLU.js";import"./eye-CStPiHBG.js";import"./circle-alert-BjoSExI5.js";import"./loader-circle-C2IDBDno.js";const en="08c4b07e3ad25f1a27c14a4e8cecb6f0",j="eip155",A="tw:connected-wallet-params";async function tn(n,i,t){if(!sn(t))throw new Error("given params are not stringifiable");const e=await n.getItem(A);let a;if(e){try{a=JSON.parse(e)}catch{a={}}a[i]=t}else a={[i]:t};n.setItem(A,D(a))}async function cn(n,i){const t=await n.getItem(A);if(!t)return null;try{const e=JSON.parse(t);return e!=null&&e[i]?e[i]:null}catch{return null}}function sn(n){try{return D(n),!0}catch{return!1}}let _=null;const P={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function En(n,i,t,e,a){var T,q,R;const r=await F(n,t,a),l=n.walletConnect;let{onDisplayUri:c}=l||{};const s=await U(t);!c&&a&&(c=M=>{const L=s.mobile.native||s.mobile.universal;if(!L){a(M);return}const G=nn(L,M).redirect;a(G)}),c&&r.events.addListener("display_uri",c);let h=l==null?void 0:l.optionalChains,d=n.chain;t==="global.safe"&&(h=z.map(g),d&&!h.includes(d)&&(d=void 0));const{chains:f,rpcMap:o}=hn({chain:d,client:n.client,optionalChains:h});await r.connect({...l!=null&&l.pairingTopic?{pairingTopic:l==null?void 0:l.pairingTopic}:{},optionalNamespaces:{[j]:{chains:f,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:o}}}),J(f.map(E=>Number(E.split(":")[1])),e);const u=((T=f[0])==null?void 0:T.split(":")[1])||1,m=S(u),C=on(r.session,"eip155:1");if(!C)throw new Error("No accounts found on provider.");const p=n.chain&&n.chain.id===m?n.chain:g(m);if(n){const E={chain:n.chain,optionalChains:(q=n.walletConnect)==null?void 0:q.optionalChains,pairingTopic:(R=n.walletConnect)==null?void 0:R.pairingTopic};e&&tn(e,t,E)}return c&&r.events.removeListener("display_uri",c),V(C,p,r,i,e,n.client,s,a)}async function rn(n,i,t){var l,c,s,h,d,f;if(!n.session)throw new Error("No session found on provider.");const e=`eip155:${i.id}`,a=I(i.id);if(k(n.session,e)){n.setDefaultChain(e);return}try{await y({provider:n,payload:{method:"wallet_switchEthereumChain",params:[{chainId:a}]},chain:e,walletInfo:t}),n.setDefaultChain(e);return}catch(o){if(((o==null?void 0:o.code)??((c=(l=o==null?void 0:o.data)==null?void 0:l.originalError)==null?void 0:c.code))===4001)throw new Error("User rejected chain switch")}const r=ln(n.session);if(!r)throw new Error("No routable chain to send wallet_addEthereumChain");try{await y({provider:n,payload:{method:"wallet_addEthereumChain",params:[{chainId:a,chainName:i.name,nativeCurrency:i.nativeCurrency,rpcUrls:[i.rpc],blockExplorerUrls:[((h=(s=i.blockExplorers)==null?void 0:s[0])==null?void 0:h.url)??""]}]},chain:r,walletInfo:t})}catch(o){throw((o==null?void 0:o.code)??((f=(d=o==null?void 0:o.data)==null?void 0:d.originalError)==null?void 0:f.code))===4001?new Error("User rejected add chain"):new Error(`Add chain failed: ${(o==null?void 0:o.message)||String(o)}`)}if(await y({provider:n,payload:{method:"wallet_switchEthereumChain",params:[{chainId:a}]},chain:e,walletInfo:t}),n.setDefaultChain(e),!k(n.session,e))throw new Error("Target chain still not enabled by wallet")}function N(n){var i;return(i=n==null?void 0:n.namespaces)==null?void 0:i.eip155}function k(n,i){var e;const t=N(n);return!!((e=t==null?void 0:t.accounts)!=null&&e.some(a=>a.startsWith(`${i}:`)))}function on(n,i){var a;const t=N(n),e=(a=t==null?void 0:t.accounts)==null?void 0:a.find(r=>r.startsWith(`${i}:`));return e?e.split(":")[2]??null:null}function ln(n){var t,e,a,r;const i=N(n);return((r=(a=(e=(t=i==null?void 0:i.accounts)==null?void 0:t[0])==null?void 0:e.split(":"))==null?void 0:a.slice(0,2))==null?void 0:r.join(":"))??null}async function vn(n,i,t,e,a){var u,m,w,C,p;const r=e?await cn(e,t):null,l=await U(t),c=await F(r?{chain:r.chain,client:n.client,walletConnect:{optionalChains:r.optionalChains,pairingTopic:r.pairingTopic}}:{client:n.client,walletConnect:{}},t,a);if(!c.session)throw await c.disconnect(),new Error("No wallet connect session found on provider.");const s=(w=(m=(u=c.session)==null?void 0:u.namespaces)==null?void 0:m[j])==null?void 0:w.accounts,h=(C=s==null?void 0:s[0])==null?void 0:C.split(":")[2];if(!h)throw new Error("No accounts found on provider.");const d=((p=n.chain)==null?void 0:p.id)||1,f=S(d),o=n.chain&&n.chain.id===f?n.chain:g(f);return V(h,o,c,i,e,n.client,l,a)}async function F(n,i,t){var h,d,f,o;if(_)return _;const e=await U(i),a=n.walletConnect,{UniversalProvider:r}=await K(async()=>{const{UniversalProvider:u}=await import("./index.es-C7NJobZH.js").then(m=>m.k);return{UniversalProvider:u}},__vite__mapDeps([0,1,2]));let l=a==null?void 0:a.optionalChains,c=n.chain;i==="global.safe"&&(l=z.map(g),c&&!l.includes(c)&&(c=void 0));const s=await r.init({metadata:{description:((h=a==null?void 0:a.appMetadata)==null?void 0:h.description)||v().description,icons:[((d=a==null?void 0:a.appMetadata)==null?void 0:d.logoUrl)||v().logoUrl],name:((f=a==null?void 0:a.appMetadata)==null?void 0:f.name)||v().name,url:((o=a==null?void 0:a.appMetadata)==null?void 0:o.url)||v().url,redirect:{native:e.mobile.native||void 0,universal:e.mobile.universal||void 0}},projectId:(a==null?void 0:a.projectId)||en});if(s.events.setMaxListeners(Number.POSITIVE_INFINITY),i!=="walletConnect"){async function u(){var w,C,p,T;const m=((T=(p=(C=(w=s.session)==null?void 0:w.peer)==null?void 0:C.metadata)==null?void 0:p.redirect)==null?void 0:T.native)||e.mobile.native||e.mobile.universal;t&&m&&await t(m)}s.on("session_request_sent",u),s.events.addListener("disconnect",()=>{s.off("session_request_sent",u),_=null})}return _=s,s}function $({provider:n,address:i,client:t,chain:e,sessionRequestHandler:a,walletInfo:r}){return{address:b(i),async sendTransaction(c){const s=await y({provider:n,payload:{method:"eth_sendTransaction",params:[{data:c.data,from:b(i),gas:c.gas?I(c.gas):void 0,to:c.to,value:c.value?I(c.value):void 0}]},chain:`eip155:${c.chainId}`,walletInfo:r,sessionRequestHandler:a});return O({chainId:c.chainId,client:t,contractAddress:c.to??void 0,gasPrice:c.gasPrice,transactionHash:s,walletAddress:b(i),walletType:"walletConnect"}),{transactionHash:s}},async signMessage({message:c}){const s=typeof c=="string"?H(c):c.raw instanceof Uint8Array?x(c.raw):c.raw;return y({provider:n,payload:{method:"personal_sign",params:[s,this.address]},chain:`eip155:${e.id}`,walletInfo:r,sessionRequestHandler:a})},async signTypedData(c){const s=an(c),{domain:h,message:d,primaryType:f}=s,o={EIP712Domain:B({domain:h}),...s.types};Q({domain:h,message:d,primaryType:f,types:o});const u=Z({domain:h??{},message:d,primaryType:f,types:o});return await y({provider:n,payload:{method:"eth_signTypedData_v4",params:[this.address,u]},chain:`eip155:${e.id}`,walletInfo:r,sessionRequestHandler:a})}}}async function y(n){var s,h,d,f;const{provider:i,payload:t,chain:e,walletInfo:a,sessionRequestHandler:r}=n,l=i.request(t,e),c=((f=(d=(h=(s=i.session)==null?void 0:s.peer)==null?void 0:h.metadata)==null?void 0:d.redirect)==null?void 0:f.native)||a.mobile.native||a.mobile.universal;return r&&c&&await r(c),l}function V(n,i,t,e,a,r,l,c){const s=$({address:n,chain:i,client:r,provider:t,sessionRequestHandler:c,walletInfo:l});async function h(){t.removeListener("accountsChanged",f),t.removeListener("chainChanged",o),t.removeListener("disconnect",d),await t.disconnect(),_=null}function d(){J([],a),a==null||a.removeItem(P.lastUsedChainId),h(),e.emit("disconnect",void 0)}function f(u){if(u[0]){const m=$({address:b(u[0]),chain:i,client:r,provider:t,sessionRequestHandler:c,walletInfo:l});e.emit("accountChanged",m),e.emit("accountsChanged",u)}else d()}function o(u){const m=g(S(u));e.emit("chainChanged",m),a==null||a.setItem(P.lastUsedChainId,String(u))}return t.on("accountsChanged",f),t.on("chainChanged",o),t.on("disconnect",d),t.on("session_delete",d),[s,i,h,u=>dn(t,u,l)]}async function dn(n,i,t){try{await rn(n,i,t)}catch(e){const a=typeof e=="string"?e:e==null?void 0:e.message;throw/user rejected request/i.test(a)?new X(e):new Y(e)}}function J(n,i){i==null||i.setItem(P.requestedChains,D(n))}function hn(n){const i={},t=[];n.chain&&(i[n.chain.id]=W({chain:n.chain,client:n.client}),t.push(n.chain.id));const e=((n==null?void 0:n.optionalChains)||[]).slice(0,10);for(const a of e)i[a.id]=W({chain:a,client:n.client}),t.push(a.id);return t.includes(1)||(i[1]=g(1).rpc,t.push(1)),{chains:t.map(a=>`eip155:${a}`),rpcMap:i}}const z=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{vn as autoConnectWC,En as connectWC};
